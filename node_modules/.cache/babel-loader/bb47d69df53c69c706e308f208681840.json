{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar events_1 = require(\"events\");\n\nvar hash_js_1 = __importDefault(require(\"hash.js\")); // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n\n\nvar hdkey_1 = __importDefault(require(\"hdkey\"));\n\nvar sdk_1 = __importDefault(require(\"@cvbb/sdk\"));\n\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\n\nvar keyringType = 'Air Gaped Device';\nvar pathBase = 'm';\nvar MAX_INDEX = 1000;\n\nvar readKeyringDescription = function () {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var decodedResult, type, result, _a, xfp, xpub, path;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , sdk_1.default.read({\n            title: 'Sync Cobo Vault',\n            description: \"Please click 'Sync' in Cobo Vault and scan the QR code displayed later\"\n          })];\n\n        case 1:\n          decodedResult = _b.sent();\n          type = decodedResult.type, result = decodedResult.result;\n\n          if (type === 'json') {\n            _a = JSON.parse(result), xfp = _a.xfp, xpub = _a.xpub, path = _a.path;\n\n            if (xfp && xpub && path) {\n              return [2\n              /*return*/\n              , {\n                xfp: xfp,\n                xpub: xpub,\n                hdPath: path\n              }];\n            }\n          } else if (type === 'none') {\n            throw new Error('Reading canceled');\n          }\n\n          throw new Error('Invalid qrcode');\n      }\n    });\n  });\n};\n\nvar AirGapedKeyring =\n/** @class */\nfunction (_super) {\n  __extends(AirGapedKeyring, _super);\n\n  function AirGapedKeyring(opts) {\n    var _this = _super.call(this) || this;\n\n    _this.xfp = '';\n    _this.xpub = '';\n    _this.hdPath = '';\n    _this.page = 0;\n    _this.perPage = 5;\n    _this.type = keyringType;\n    _this.accounts = [];\n    _this.currentAccount = 0;\n    _this.paths = {};\n    _this.latestAccount = 0;\n\n    _this.deserialize(opts);\n\n    return _this;\n  }\n\n  AirGapedKeyring.getKeyring = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, xpub, xfp, hdPath;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , readKeyringDescription()];\n\n          case 1:\n            _a = _b.sent(), xpub = _a.xpub, xfp = _a.xfp, hdPath = _a.hdPath;\n            return [2\n            /*return*/\n            , new AirGapedKeyring({\n              xfp: xfp,\n              xpub: xpub,\n              hdPath: hdPath,\n              perPage: 5,\n              page: 0,\n              accounts: [],\n              currentAccount: 0,\n              paths: {}\n            })];\n        }\n      });\n    });\n  };\n\n  AirGapedKeyring.getEmptyKeyring = function () {\n    return new AirGapedKeyring({\n      xfp: '',\n      xpub: '',\n      hdPath: '',\n      perPage: 5,\n      page: 0,\n      accounts: [],\n      currentAccount: 0,\n      paths: {}\n    });\n  };\n\n  AirGapedKeyring.prototype.readKeyring = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, xpub, xfp, hdPath;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , readKeyringDescription()];\n\n          case 1:\n            _a = _b.sent(), xpub = _a.xpub, xfp = _a.xfp, hdPath = _a.hdPath;\n            this.xfp = xfp;\n            this.xpub = xpub;\n            this.hdPath = hdPath;\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  AirGapedKeyring.prototype.checkKeyring = function () {\n    if (!this.xfp || !this.xpub || !this.hdPath) {\n      throw new Error('keyring not fulfilled, please call function `readKeyring` firstly');\n    }\n  };\n\n  AirGapedKeyring.prototype.serialize = function () {\n    return Promise.resolve({\n      xfp: this.xfp,\n      xpub: this.xpub,\n      hdPath: this.hdPath,\n      accounts: this.accounts,\n      currentAccount: this.currentAccount,\n      page: this.page,\n      perPage: this.perPage,\n      paths: this.paths\n    });\n  };\n\n  AirGapedKeyring.prototype.deserialize = function (opts) {\n    this.xfp = opts.xfp;\n    this.xpub = opts.xpub;\n    this.hdPath = opts.hdPath;\n    this.accounts = opts.accounts;\n    this.currentAccount = opts.currentAccount;\n    this.page = opts.page;\n    this.perPage = opts.perPage;\n    this.paths = opts.paths;\n  };\n\n  AirGapedKeyring.prototype.setCurrentAccount = function (index) {\n    this.currentAccount = index;\n  };\n\n  AirGapedKeyring.prototype.getCurrentAccount = function () {\n    return this.currentAccount;\n  };\n\n  AirGapedKeyring.prototype.getCurrentAddress = function () {\n    return this.accounts[this.currentAccount];\n  };\n\n  AirGapedKeyring.prototype.addAccounts = function (n) {\n    var _this = this;\n\n    if (n === void 0) {\n      n = 1;\n    }\n\n    return new Promise(function (resolve, reject) {\n      try {\n        var from = _this.latestAccount;\n        var to = from + n;\n        var newAccounts = [];\n\n        for (var i = from; i < to; i++) {\n          var address = _this._addressFromIndex(pathBase, i);\n\n          newAccounts.push(address);\n          _this.page = 0;\n          _this.latestAccount++;\n        }\n\n        _this.accounts = _this.accounts.concat(newAccounts);\n        resolve(_this.accounts);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  };\n\n  AirGapedKeyring.prototype.getFirstPage = function () {\n    this.page = 0;\n    return this.__getPage(1);\n  };\n\n  AirGapedKeyring.prototype.getNextPage = function () {\n    return this.__getPage(1);\n  };\n\n  AirGapedKeyring.prototype.getPreviousPage = function () {\n    return this.__getPage(-1);\n  };\n\n  AirGapedKeyring.prototype.__getPage = function (increment) {\n    var _this = this;\n\n    this.page += increment;\n\n    if (this.page <= 0) {\n      this.page = 1;\n    }\n\n    return new Promise(function (resolve, reject) {\n      try {\n        var from = (_this.page - 1) * _this.perPage;\n        var to = from + _this.perPage;\n        var accounts = [];\n\n        for (var i = from; i < to; i++) {\n          var address = _this._addressFromIndex(pathBase, i);\n\n          accounts.push({\n            address: address,\n            balance: null,\n            index: i\n          });\n          _this.paths[ethereumjs_util_1.toChecksumAddress(address)] = i;\n        }\n\n        resolve(accounts);\n      } catch (e) {\n        reject(e);\n      }\n    });\n  };\n\n  AirGapedKeyring.prototype.getAccounts = function () {\n    return this.accounts;\n  };\n\n  AirGapedKeyring.prototype.removeAccount = function (address) {\n    if (!this.accounts.map(function (a) {\n      return a.toLowerCase();\n    }).includes(address.toLowerCase())) {\n      throw new Error(\"Address \" + address + \" not found in this keyring\");\n    }\n\n    this.accounts = this.accounts.filter(function (a) {\n      return a.toLowerCase() !== address.toLowerCase();\n    });\n  };\n\n  AirGapedKeyring.prototype.readSignature = function (signId) {\n    return __awaiter(this, void 0, void 0, function () {\n      var signature, _a, peerSignId, signatureHex, r, s, v;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , sdk_1.default.read({\n              title: 'Submit signing result',\n              description: 'Please scan signing result QR code displayed on your Cobo Vault'\n            })];\n\n          case 1:\n            signature = _b.sent();\n\n            if (signature) {\n              if (signature.type === 'ur') {\n                _a = JSON.parse(Buffer.from(signature.result, 'hex').toString('utf-8')), peerSignId = _a.signId, signatureHex = _a.signature;\n\n                if (peerSignId && signatureHex) {\n                  if (peerSignId !== signId) {\n                    throw new Error('read signature error: mismatched signId');\n                  }\n\n                  r = Buffer.from(signatureHex.slice(0, 64), 'hex');\n                  s = Buffer.from(signatureHex.slice(64, 128), 'hex');\n                  v = Buffer.from(signatureHex.slice(128), 'hex');\n                  return [2\n                  /*return*/\n                  , {\n                    r: r,\n                    s: s,\n                    v: v\n                  }];\n                }\n\n                throw new Error('invalid signature qrcode');\n              } else {\n                throw new Error('invalid signature qrcode');\n              }\n            }\n\n            throw new Error('read signature canceled');\n        }\n      });\n    });\n  }; // tx is an instance of the ethereumjs-transaction class.\n\n\n  AirGapedKeyring.serializeTx = function (tx) {\n    var items = __spreadArray(__spreadArray([], tx.raw.slice(0, 6)), [ethereumjs_util_1.toBuffer(tx.getChainId()), // TODO: stripping zeros should probably be a responsibility of the rlp module\n    ethereumjs_util_1.unpadBuffer(ethereumjs_util_1.toBuffer(0)), ethereumjs_util_1.unpadBuffer(ethereumjs_util_1.toBuffer(0))]);\n\n    return ethereumjs_util_1.rlp.encode(items);\n  };\n\n  AirGapedKeyring.prototype.signTransaction = function (address, tx) {\n    return __awaiter(this, void 0, void 0, function () {\n      var txHex, hdPath, signId, signPayload, _a, r, s, v;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            txHex = AirGapedKeyring.serializeTx(tx).toString('hex');\n            hdPath = this._pathFromAddress(address);\n            signId = hash_js_1.default.sha256().update(\"\" + txHex + hdPath + this.xfp).digest('hex').slice(0, 8);\n            signPayload = {\n              txHex: txHex,\n              xfp: this.xfp,\n              hdPath: hdPath,\n              signId: signId\n            };\n            return [4\n            /*yield*/\n            , sdk_1.default.play(Buffer.from(JSON.stringify(signPayload), 'utf-8').toString('hex'), {\n              hasNext: true,\n              title: 'Request signing transaction',\n              description: 'Please scan the QR code below with Cobo Vault, review transaction information and authorize to sign'\n            })];\n\n          case 1:\n            _b.sent();\n\n            return [4\n            /*yield*/\n            , this.readSignature(signId)];\n\n          case 2:\n            _a = _b.sent(), r = _a.r, s = _a.s, v = _a.v;\n            tx.r = r;\n            tx.s = s;\n            tx.v = v;\n            return [2\n            /*return*/\n            , tx];\n        }\n      });\n    });\n  };\n\n  AirGapedKeyring.prototype.signMessage = function (withAccount, data) {\n    return this.signPersonalMessage(withAccount, data);\n  };\n\n  AirGapedKeyring.prototype.signPersonalMessage = function (withAccount, messageHex) {\n    return __awaiter(this, void 0, void 0, function () {\n      var hdPath, signId, signPayload, _a, r, s, v;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            hdPath = this._pathFromAddress(withAccount);\n            signId = hash_js_1.default.sha256().update(\"\" + messageHex + hdPath + this.xfp).digest('hex').slice(0, 8);\n            signPayload = {\n              messageHex: messageHex,\n              xfp: this.xfp,\n              hdPath: hdPath,\n              signId: signId\n            };\n            return [4\n            /*yield*/\n            , sdk_1.default.play(Buffer.from(JSON.stringify(signPayload), 'utf-8').toString('hex'), {\n              hasNext: true,\n              title: 'Request signing message',\n              description: 'Please scan the QR code below with Cobo Vault, review message and authorize to sign'\n            })];\n\n          case 1:\n            _b.sent();\n\n            return [4\n            /*yield*/\n            , this.readSignature(signId)];\n\n          case 2:\n            _a = _b.sent(), r = _a.r, s = _a.s, v = _a.v;\n            return [2\n            /*return*/\n            , '0x' + r + s + v];\n        }\n      });\n    });\n  };\n\n  AirGapedKeyring.prototype.signTypedData = function (withAccount, typedData) {\n    return __awaiter(this, void 0, void 0, function () {\n      var hdPath, signId, signPayload, _a, r, s, v;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            hdPath = this._pathFromAddress(withAccount);\n            signId = hash_js_1.default.sha256().update(\"\" + JSON.stringify(typedData) + hdPath + this.xfp).digest('hex').slice(0, 8);\n            signPayload = {\n              data: typedData,\n              xfp: this.xfp,\n              hdPath: hdPath,\n              signId: signId\n            };\n            return [4\n            /*yield*/\n            , sdk_1.default.play(Buffer.from(JSON.stringify(signPayload), 'utf-8').toString('hex'), {\n              hasNext: true,\n              title: 'Request signing typed data',\n              description: 'Please scan the QR code below with Cobo Vault, review data and authorize to sign'\n            })];\n\n          case 1:\n            _b.sent();\n\n            return [4\n            /*yield*/\n            , this.readSignature(signId)];\n\n          case 2:\n            _a = _b.sent(), r = _a.r, s = _a.s, v = _a.v;\n            return [2\n            /*return*/\n            , Buffer.concat([r, s, v])];\n        }\n      });\n    });\n  };\n\n  AirGapedKeyring.prototype._addressFromIndex = function (pb, i) {\n    this.checkKeyring();\n\n    if (!this.hdk) {\n      this.hdk = hdkey_1.default.fromExtendedKey(this.xpub);\n    }\n\n    var dkey = this.hdk.derive(pb + \"/0/\" + i);\n    var address = '0x' + ethereumjs_util_1.publicToAddress(dkey.publicKey, true).toString('hex');\n    return ethereumjs_util_1.toChecksumAddress(address);\n  };\n\n  AirGapedKeyring.prototype._pathFromAddress = function (address) {\n    var checksummedAddress = ethereumjs_util_1.toChecksumAddress(address);\n    var index = this.paths[checksummedAddress];\n\n    if (typeof index === 'undefined') {\n      for (var i = 0; i < MAX_INDEX; i++) {\n        if (checksummedAddress === this._addressFromIndex(pathBase, i)) {\n          index = i;\n          break;\n        }\n      }\n    }\n\n    if (typeof index === 'undefined') {\n      throw new Error('Unknown address');\n    }\n\n    return this.hdPath + \"/0/\" + index;\n  };\n\n  AirGapedKeyring.type = keyringType;\n  return AirGapedKeyring;\n}(events_1.EventEmitter);\n\nexports.default = AirGapedKeyring;","map":{"version":3,"mappings":"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","names":["keyringType","pathBase","MAX_INDEX","readKeyringDescription","sdk_1","read","title","description","decodedResult","_b","type","result","_a","JSON","parse","xfp","xpub","path","hdPath","Error","__extends","opts","_super","_this","page","perPage","accounts","currentAccount","paths","latestAccount","deserialize","AirGapedKeyring","Promise","resolve","index","n","reject","from","to","newAccounts","i","address","_addressFromIndex","push","concat","e","__getPage","increment","balance","ethereumjs_util_1","map","a","toLowerCase","includes","filter","signId","signature","Buffer","toString","peerSignId","signatureHex","r","slice","s","v","tx","items","raw","getChainId","encode","txHex","serializeTx","_pathFromAddress","hash_js_1","sha256","update","digest","signPayload","play","stringify","hasNext","readSignature","withAccount","data","signPersonalMessage","messageHex","typedData","pb","checkKeyring","hdk","hdkey_1","fromExtendedKey","dkey","derive","publicKey","checksummedAddress","events_1","exports"],"sourceRoot":"","sources":["../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}