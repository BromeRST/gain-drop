{"ast":null,"code":"import SturdyWebSocket from 'sturdy-websocket';\nimport CryptoEs from 'crypto-es';\nconst networks = {\n  bitcoin: {\n    '1': 'main',\n    '2': 'testnet'\n  },\n  ethereum: {\n    '1': 'main',\n    '3': 'ropsten',\n    '4': 'rinkeby',\n    '5': 'goerli',\n    '42': 'kovan',\n    '56': 'bsc-main',\n    '100': 'xdai',\n    '137': 'matic-main',\n    '250': 'fantom-main'\n  }\n};\nconst DEFAULT_RATE_LIMIT_RULES = {\n  points: 150,\n  duration: 1\n};\nconst QUEUE_LIMIT = 10000;\n\nfunction createEmitter() {\n  return {\n    listeners: {},\n    on: function (eventCode, listener) {\n      // check if valid eventCode\n      switch (eventCode) {\n        case 'txSent':\n        case 'txPool':\n        case 'txConfirmed':\n        case 'txSpeedUp':\n        case 'txCancel':\n        case 'txFailed':\n        case 'txDropped':\n        case 'txRequest':\n        case 'nsfFail':\n        case 'txRepeat':\n        case 'txAwaitingApproval':\n        case 'txConfirmReminder':\n        case 'txSendFail':\n        case 'txError':\n        case 'txUnderPriced':\n        case 'txPoolSimulation':\n        case 'all':\n          break;\n\n        default:\n          throw new Error(`${eventCode} is not a valid event code, for a list of valid event codes see: https://docs.blocknative.com/notify-sdk#event-codes`);\n      } // check that listener is a function\n\n\n      if (typeof listener !== 'function') {\n        throw new Error('Listener must be a function');\n      } // add listener for the eventCode\n\n\n      this.listeners[eventCode] = listener;\n    },\n    off: function (eventCode) {\n      delete this.listeners[eventCode];\n    },\n    emit: function (state) {\n      if (this.listeners[state.eventCode]) {\n        return this.listeners[state.eventCode](state);\n      }\n\n      if (this.listeners.all) {\n        return this.listeners.all(state);\n      }\n    }\n  };\n}\n\nfunction networkName(blockchain, id) {\n  return networks[blockchain][id];\n}\n\nfunction serverEcho(eventCode) {\n  switch (eventCode) {\n    case 'txRequest':\n    case 'nsfFail':\n    case 'txRepeat':\n    case 'txAwaitingApproval':\n    case 'txConfirmReminder':\n    case 'txSendFail':\n    case 'txError':\n    case 'txUnderPriced':\n    case 'txSent':\n      return true;\n\n    default:\n      return false;\n  }\n}\n\nfunction last(arr) {\n  return arr.reverse()[0];\n} // isAddress and isTxid are not meant to perform real validation,\n// just needs to work out if it is an address or a transaction id\n// the server will do more thorough validation\n\n\nfunction isAddress(blockchain, addressOrHash) {\n  switch (blockchain) {\n    case 'ethereum':\n      return addressOrHash.length === 42;\n\n    case 'bitcoin':\n      return addressOrHash.length !== 64;\n\n    default:\n      return false;\n  }\n}\n\nfunction isTxid(blockchain, addressOrHash) {\n  switch (blockchain) {\n    case 'ethereum':\n      return addressOrHash.length === 66;\n\n    case 'bitcoin':\n      return addressOrHash.length === 64;\n\n    default:\n      return false;\n  }\n}\n\nfunction wait(time) {\n  return new Promise(resolve => {\n    setTimeout(resolve, time);\n  });\n}\n\nconst jsonPreserveUndefined = (k, v) => v === undefined ? 'undefined' : v;\n/**\r\n * Tests if LocalStorage may be used. Accounts for environments where\r\n * LocalStorage is not supported, as well as those where it is blocked.\r\n *\r\n * @returns `true` if LocalStorage is supported and accessible, `false` otherwise.\r\n */\n\n\nfunction isLocalStorageAvailable() {\n  const isSupported = typeof window !== 'undefined' && 'localStorage' in window;\n\n  if (isSupported) {\n    const testKey = '__testLocalStorage';\n\n    try {\n      window.localStorage.setItem(testKey, '1');\n      window.localStorage.removeItem(testKey);\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  return false;\n}\n\nfunction transaction(hash, id) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.'); // create startTime for transaction\n\n  const startTime = Date.now(); // create emitter for transaction\n\n  const emitter = createEmitter(); // create eventCode for transaction\n\n  const eventCode = 'txSent'; // put in queue\n\n  this._watchedTransactions.push({\n    hash,\n    emitter\n  });\n\n  const transaction = {\n    [this._system === 'ethereum' ? 'hash' : 'txid']: hash,\n    id: id || hash,\n    startTime,\n    status: 'sent'\n  };\n  const newState = { ...transaction,\n    eventCode\n  }; // logEvent to server\n\n  this._sendMessage({\n    eventCode,\n    categoryCode: 'activeTransaction',\n    transaction\n  });\n\n  const transactionObj = {\n    details: newState,\n    emitter\n  };\n\n  function emitState() {\n    const emitterResult = emitter.emit(newState);\n\n    this._transactionHandlers.forEach(handler => handler({\n      transaction: newState,\n      emitterResult\n    }));\n  } // emit after delay to allow for listener to be registered\n\n\n  setTimeout(emitState.bind(this), 5);\n  return transactionObj;\n}\n\nfunction account(address) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.'); // lowercase the address if Ethereum\n\n  address = this._system === 'ethereum' ? address.toLowerCase() : address; // create emitter for transaction\n\n  const emitter = createEmitter(); // create eventCode for transaction\n\n  const eventCode = 'watch';\n\n  const existingAddressWatcher = this._watchedAccounts.find(ac => ac.address === address);\n\n  if (existingAddressWatcher) {\n    // add to existing emitters array\n    existingAddressWatcher.emitters.push(emitter);\n  } else {\n    // put in accounts queue\n    this._watchedAccounts.push({\n      address,\n      emitters: [emitter]\n    });\n  } // logEvent to server\n\n\n  this._sendMessage({\n    eventCode,\n    categoryCode: 'accountAddress',\n    account: {\n      address\n    }\n  });\n\n  return {\n    emitter,\n    details: {\n      address\n    }\n  };\n}\n\nfunction event(eventObj) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n\n  this._sendMessage(eventObj);\n}\n\nfunction unsubscribe(addressOrHash) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n  const address = isAddress(this._system, addressOrHash);\n  const txid = isTxid(this._system, addressOrHash); // check if it is an address or a hash\n\n  if (address) {\n    const normalizedAddress = this._system === 'ethereum' ? addressOrHash.toLowerCase() : addressOrHash; // remove address from accounts\n\n    this._watchedAccounts = this._watchedAccounts.filter(ac => ac.address !== normalizedAddress); // logEvent to server\n\n    this._sendMessage({\n      categoryCode: 'accountAddress',\n      eventCode: 'unwatch',\n      account: {\n        address: normalizedAddress\n      }\n    });\n  } else if (txid) {\n    // remove transaction from transactions\n    this._watchedTransactions = this._watchedTransactions.filter(tx => tx.hash !== addressOrHash); // logEvent to server\n\n    this._sendMessage({\n      categoryCode: 'activeTransaction',\n      eventCode: 'unwatch',\n      transaction: {\n        [this._system === 'ethereum' ? 'hash' : 'txid']: addressOrHash,\n        id: addressOrHash,\n        status: 'unsubscribed'\n      }\n    });\n  } else {\n    throw new Error(`Error trying to unsubscribe ${addressOrHash}: not a valid address or transaction id/hash`);\n  }\n}\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isFunction(x) {\n  return typeof x === 'function';\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar _enable_super_gross_mode_that_will_cause_bad_things = false;\nvar config = {\n  Promise: undefined,\n\n  set useDeprecatedSynchronousErrorHandling(value) {\n    if (value) {\n      var error = /*@__PURE__*/new Error();\n      /*@__PURE__*/\n\n      console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n' + error.stack);\n    }\n\n    _enable_super_gross_mode_that_will_cause_bad_things = value;\n  },\n\n  get useDeprecatedSynchronousErrorHandling() {\n    return _enable_super_gross_mode_that_will_cause_bad_things;\n  }\n\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nfunction hostReportError(err) {\n  setTimeout(function () {\n    throw err;\n  }, 0);\n}\n/** PURE_IMPORTS_START _config,_util_hostReportError PURE_IMPORTS_END */\n\n\nvar empty = {\n  closed: true,\n  next: function (value) {},\n  error: function (err) {\n    if (config.useDeprecatedSynchronousErrorHandling) {\n      throw err;\n    } else {\n      hostReportError(err);\n    }\n  },\n  complete: function () {}\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar isArray = /*@__PURE__*/function () {\n  return Array.isArray || function (x) {\n    return x && typeof x.length === 'number';\n  };\n}();\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isObject(x) {\n  return x !== null && typeof x === 'object';\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar UnsubscriptionErrorImpl = /*@__PURE__*/function () {\n  function UnsubscriptionErrorImpl(errors) {\n    Error.call(this);\n    this.message = errors ? errors.length + \" errors occurred during unsubscription:\\n\" + errors.map(function (err, i) {\n      return i + 1 + \") \" + err.toString();\n    }).join('\\n  ') : '';\n    this.name = 'UnsubscriptionError';\n    this.errors = errors;\n    return this;\n  }\n\n  UnsubscriptionErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return UnsubscriptionErrorImpl;\n}();\n\nvar UnsubscriptionError = UnsubscriptionErrorImpl;\n/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */\n\nvar Subscription = /*@__PURE__*/function () {\n  function Subscription(unsubscribe) {\n    this.closed = false;\n    this._parentOrParents = null;\n    this._subscriptions = null;\n\n    if (unsubscribe) {\n      this._ctorUnsubscribe = true;\n      this._unsubscribe = unsubscribe;\n    }\n  }\n\n  Subscription.prototype.unsubscribe = function () {\n    var errors;\n\n    if (this.closed) {\n      return;\n    }\n\n    var _a = this,\n        _parentOrParents = _a._parentOrParents,\n        _ctorUnsubscribe = _a._ctorUnsubscribe,\n        _unsubscribe = _a._unsubscribe,\n        _subscriptions = _a._subscriptions;\n\n    this.closed = true;\n    this._parentOrParents = null;\n    this._subscriptions = null;\n\n    if (_parentOrParents instanceof Subscription) {\n      _parentOrParents.remove(this);\n    } else if (_parentOrParents !== null) {\n      for (var index = 0; index < _parentOrParents.length; ++index) {\n        var parent_1 = _parentOrParents[index];\n        parent_1.remove(this);\n      }\n    }\n\n    if (isFunction(_unsubscribe)) {\n      if (_ctorUnsubscribe) {\n        this._unsubscribe = undefined;\n      }\n\n      try {\n        _unsubscribe.call(this);\n      } catch (e) {\n        errors = e instanceof UnsubscriptionError ? flattenUnsubscriptionErrors(e.errors) : [e];\n      }\n    }\n\n    if (isArray(_subscriptions)) {\n      var index = -1;\n      var len = _subscriptions.length;\n\n      while (++index < len) {\n        var sub = _subscriptions[index];\n\n        if (isObject(sub)) {\n          try {\n            sub.unsubscribe();\n          } catch (e) {\n            errors = errors || [];\n\n            if (e instanceof UnsubscriptionError) {\n              errors = errors.concat(flattenUnsubscriptionErrors(e.errors));\n            } else {\n              errors.push(e);\n            }\n          }\n        }\n      }\n    }\n\n    if (errors) {\n      throw new UnsubscriptionError(errors);\n    }\n  };\n\n  Subscription.prototype.add = function (teardown) {\n    var subscription = teardown;\n\n    if (!teardown) {\n      return Subscription.EMPTY;\n    }\n\n    switch (typeof teardown) {\n      case 'function':\n        subscription = new Subscription(teardown);\n\n      case 'object':\n        if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {\n          return subscription;\n        } else if (this.closed) {\n          subscription.unsubscribe();\n          return subscription;\n        } else if (!(subscription instanceof Subscription)) {\n          var tmp = subscription;\n          subscription = new Subscription();\n          subscription._subscriptions = [tmp];\n        }\n\n        break;\n\n      default:\n        {\n          throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n        }\n    }\n\n    var _parentOrParents = subscription._parentOrParents;\n\n    if (_parentOrParents === null) {\n      subscription._parentOrParents = this;\n    } else if (_parentOrParents instanceof Subscription) {\n      if (_parentOrParents === this) {\n        return subscription;\n      }\n\n      subscription._parentOrParents = [_parentOrParents, this];\n    } else if (_parentOrParents.indexOf(this) === -1) {\n      _parentOrParents.push(this);\n    } else {\n      return subscription;\n    }\n\n    var subscriptions = this._subscriptions;\n\n    if (subscriptions === null) {\n      this._subscriptions = [subscription];\n    } else {\n      subscriptions.push(subscription);\n    }\n\n    return subscription;\n  };\n\n  Subscription.prototype.remove = function (subscription) {\n    var subscriptions = this._subscriptions;\n\n    if (subscriptions) {\n      var subscriptionIndex = subscriptions.indexOf(subscription);\n\n      if (subscriptionIndex !== -1) {\n        subscriptions.splice(subscriptionIndex, 1);\n      }\n    }\n  };\n\n  Subscription.EMPTY = function (empty) {\n    empty.closed = true;\n    return empty;\n  }(new Subscription());\n\n  return Subscription;\n}();\n\nfunction flattenUnsubscriptionErrors(errors) {\n  return errors.reduce(function (errs, err) {\n    return errs.concat(err instanceof UnsubscriptionError ? err.errors : err);\n  }, []);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar rxSubscriber = /*@__PURE__*/function () {\n  return typeof Symbol === 'function' ? /*@__PURE__*/Symbol('rxSubscriber') : '@@rxSubscriber_' + /*@__PURE__*/Math.random();\n}();\n/** PURE_IMPORTS_START tslib,_util_isFunction,_Observer,_Subscription,_internal_symbol_rxSubscriber,_config,_util_hostReportError PURE_IMPORTS_END */\n\n\nvar Subscriber = /*@__PURE__*/function (_super) {\n  __extends(Subscriber, _super);\n\n  function Subscriber(destinationOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    _this.syncErrorValue = null;\n    _this.syncErrorThrown = false;\n    _this.syncErrorThrowable = false;\n    _this.isStopped = false;\n\n    switch (arguments.length) {\n      case 0:\n        _this.destination = empty;\n        break;\n\n      case 1:\n        if (!destinationOrNext) {\n          _this.destination = empty;\n          break;\n        }\n\n        if (typeof destinationOrNext === 'object') {\n          if (destinationOrNext instanceof Subscriber) {\n            _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;\n            _this.destination = destinationOrNext;\n            destinationOrNext.add(_this);\n          } else {\n            _this.syncErrorThrowable = true;\n            _this.destination = new SafeSubscriber(_this, destinationOrNext);\n          }\n\n          break;\n        }\n\n      default:\n        _this.syncErrorThrowable = true;\n        _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);\n        break;\n    }\n\n    return _this;\n  }\n\n  Subscriber.prototype[rxSubscriber] = function () {\n    return this;\n  };\n\n  Subscriber.create = function (next, error, complete) {\n    var subscriber = new Subscriber(next, error, complete);\n    subscriber.syncErrorThrowable = false;\n    return subscriber;\n  };\n\n  Subscriber.prototype.next = function (value) {\n    if (!this.isStopped) {\n      this._next(value);\n    }\n  };\n\n  Subscriber.prototype.error = function (err) {\n    if (!this.isStopped) {\n      this.isStopped = true;\n\n      this._error(err);\n    }\n  };\n\n  Subscriber.prototype.complete = function () {\n    if (!this.isStopped) {\n      this.isStopped = true;\n\n      this._complete();\n    }\n  };\n\n  Subscriber.prototype.unsubscribe = function () {\n    if (this.closed) {\n      return;\n    }\n\n    this.isStopped = true;\n\n    _super.prototype.unsubscribe.call(this);\n  };\n\n  Subscriber.prototype._next = function (value) {\n    this.destination.next(value);\n  };\n\n  Subscriber.prototype._error = function (err) {\n    this.destination.error(err);\n    this.unsubscribe();\n  };\n\n  Subscriber.prototype._complete = function () {\n    this.destination.complete();\n    this.unsubscribe();\n  };\n\n  Subscriber.prototype._unsubscribeAndRecycle = function () {\n    var _parentOrParents = this._parentOrParents;\n    this._parentOrParents = null;\n    this.unsubscribe();\n    this.closed = false;\n    this.isStopped = false;\n    this._parentOrParents = _parentOrParents;\n    return this;\n  };\n\n  return Subscriber;\n}(Subscription);\n\nvar SafeSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SafeSubscriber, _super);\n\n  function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    _this._parentSubscriber = _parentSubscriber;\n    var next;\n    var context = _this;\n\n    if (isFunction(observerOrNext)) {\n      next = observerOrNext;\n    } else if (observerOrNext) {\n      next = observerOrNext.next;\n      error = observerOrNext.error;\n      complete = observerOrNext.complete;\n\n      if (observerOrNext !== empty) {\n        context = Object.create(observerOrNext);\n\n        if (isFunction(context.unsubscribe)) {\n          _this.add(context.unsubscribe.bind(context));\n        }\n\n        context.unsubscribe = _this.unsubscribe.bind(_this);\n      }\n    }\n\n    _this._context = context;\n    _this._next = next;\n    _this._error = error;\n    _this._complete = complete;\n    return _this;\n  }\n\n  SafeSubscriber.prototype.next = function (value) {\n    if (!this.isStopped && this._next) {\n      var _parentSubscriber = this._parentSubscriber;\n\n      if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n        this.__tryOrUnsub(this._next, value);\n      } else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.error = function (err) {\n    if (!this.isStopped) {\n      var _parentSubscriber = this._parentSubscriber;\n      var useDeprecatedSynchronousErrorHandling = config.useDeprecatedSynchronousErrorHandling;\n\n      if (this._error) {\n        if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n          this.__tryOrUnsub(this._error, err);\n\n          this.unsubscribe();\n        } else {\n          this.__tryOrSetError(_parentSubscriber, this._error, err);\n\n          this.unsubscribe();\n        }\n      } else if (!_parentSubscriber.syncErrorThrowable) {\n        this.unsubscribe();\n\n        if (useDeprecatedSynchronousErrorHandling) {\n          throw err;\n        }\n\n        hostReportError(err);\n      } else {\n        if (useDeprecatedSynchronousErrorHandling) {\n          _parentSubscriber.syncErrorValue = err;\n          _parentSubscriber.syncErrorThrown = true;\n        } else {\n          hostReportError(err);\n        }\n\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.complete = function () {\n    var _this = this;\n\n    if (!this.isStopped) {\n      var _parentSubscriber = this._parentSubscriber;\n\n      if (this._complete) {\n        var wrappedComplete = function () {\n          return _this._complete.call(_this._context);\n        };\n\n        if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n          this.__tryOrUnsub(wrappedComplete);\n\n          this.unsubscribe();\n        } else {\n          this.__tryOrSetError(_parentSubscriber, wrappedComplete);\n\n          this.unsubscribe();\n        }\n      } else {\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {\n    try {\n      fn.call(this._context, value);\n    } catch (err) {\n      this.unsubscribe();\n\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        throw err;\n      } else {\n        hostReportError(err);\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {\n    if (!config.useDeprecatedSynchronousErrorHandling) {\n      throw new Error('bad call');\n    }\n\n    try {\n      fn.call(this._context, value);\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        parent.syncErrorValue = err;\n        parent.syncErrorThrown = true;\n        return true;\n      } else {\n        hostReportError(err);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  SafeSubscriber.prototype._unsubscribe = function () {\n    var _parentSubscriber = this._parentSubscriber;\n    this._context = null;\n    this._parentSubscriber = null;\n\n    _parentSubscriber.unsubscribe();\n  };\n\n  return SafeSubscriber;\n}(Subscriber);\n/** PURE_IMPORTS_START _Subscriber PURE_IMPORTS_END */\n\n\nfunction canReportError(observer) {\n  while (observer) {\n    var _a = observer,\n        closed_1 = _a.closed,\n        destination = _a.destination,\n        isStopped = _a.isStopped;\n\n    if (closed_1 || isStopped) {\n      return false;\n    } else if (destination && destination instanceof Subscriber) {\n      observer = destination;\n    } else {\n      observer = null;\n    }\n  }\n\n  return true;\n}\n/** PURE_IMPORTS_START _Subscriber,_symbol_rxSubscriber,_Observer PURE_IMPORTS_END */\n\n\nfunction toSubscriber(nextOrObserver, error, complete) {\n  if (nextOrObserver) {\n    if (nextOrObserver instanceof Subscriber) {\n      return nextOrObserver;\n    }\n\n    if (nextOrObserver[rxSubscriber]) {\n      return nextOrObserver[rxSubscriber]();\n    }\n  }\n\n  if (!nextOrObserver && !error && !complete) {\n    return new Subscriber(empty);\n  }\n\n  return new Subscriber(nextOrObserver, error, complete);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar observable = /*@__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction identity(x) {\n  return x;\n}\n/** PURE_IMPORTS_START _identity PURE_IMPORTS_END */\n\n\nfunction pipeFromArray(fns) {\n  if (fns.length === 0) {\n    return identity;\n  }\n\n  if (fns.length === 1) {\n    return fns[0];\n  }\n\n  return function piped(input) {\n    return fns.reduce(function (prev, fn) {\n      return fn(prev);\n    }, input);\n  };\n}\n/** PURE_IMPORTS_START _util_canReportError,_util_toSubscriber,_symbol_observable,_util_pipe,_config PURE_IMPORTS_END */\n\n\nvar Observable = /*@__PURE__*/function () {\n  function Observable(subscribe) {\n    this._isScalar = false;\n\n    if (subscribe) {\n      this._subscribe = subscribe;\n    }\n  }\n\n  Observable.prototype.lift = function (operator) {\n    var observable = new Observable();\n    observable.source = this;\n    observable.operator = operator;\n    return observable;\n  };\n\n  Observable.prototype.subscribe = function (observerOrNext, error, complete) {\n    var operator = this.operator;\n    var sink = toSubscriber(observerOrNext, error, complete);\n\n    if (operator) {\n      sink.add(operator.call(sink, this.source));\n    } else {\n      sink.add(this.source || config.useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable ? this._subscribe(sink) : this._trySubscribe(sink));\n    }\n\n    if (config.useDeprecatedSynchronousErrorHandling) {\n      if (sink.syncErrorThrowable) {\n        sink.syncErrorThrowable = false;\n\n        if (sink.syncErrorThrown) {\n          throw sink.syncErrorValue;\n        }\n      }\n    }\n\n    return sink;\n  };\n\n  Observable.prototype._trySubscribe = function (sink) {\n    try {\n      return this._subscribe(sink);\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        sink.syncErrorThrown = true;\n        sink.syncErrorValue = err;\n      }\n\n      if (canReportError(sink)) {\n        sink.error(err);\n      } else {\n        console.warn(err);\n      }\n    }\n  };\n\n  Observable.prototype.forEach = function (next, promiseCtor) {\n    var _this = this;\n\n    promiseCtor = getPromiseCtor(promiseCtor);\n    return new promiseCtor(function (resolve, reject) {\n      var subscription;\n      subscription = _this.subscribe(function (value) {\n        try {\n          next(value);\n        } catch (err) {\n          reject(err);\n\n          if (subscription) {\n            subscription.unsubscribe();\n          }\n        }\n      }, reject, resolve);\n    });\n  };\n\n  Observable.prototype._subscribe = function (subscriber) {\n    var source = this.source;\n    return source && source.subscribe(subscriber);\n  };\n\n  Observable.prototype[observable] = function () {\n    return this;\n  };\n\n  Observable.prototype.pipe = function () {\n    var operations = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      operations[_i] = arguments[_i];\n    }\n\n    if (operations.length === 0) {\n      return this;\n    }\n\n    return pipeFromArray(operations)(this);\n  };\n\n  Observable.prototype.toPromise = function (promiseCtor) {\n    var _this = this;\n\n    promiseCtor = getPromiseCtor(promiseCtor);\n    return new promiseCtor(function (resolve, reject) {\n      var value;\n\n      _this.subscribe(function (x) {\n        return value = x;\n      }, function (err) {\n        return reject(err);\n      }, function () {\n        return resolve(value);\n      });\n    });\n  };\n\n  Observable.create = function (subscribe) {\n    return new Observable(subscribe);\n  };\n\n  return Observable;\n}();\n\nfunction getPromiseCtor(promiseCtor) {\n  if (!promiseCtor) {\n    promiseCtor = Promise;\n  }\n\n  if (!promiseCtor) {\n    throw new Error('no Promise impl found');\n  }\n\n  return promiseCtor;\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar ObjectUnsubscribedErrorImpl = /*@__PURE__*/function () {\n  function ObjectUnsubscribedErrorImpl() {\n    Error.call(this);\n    this.message = 'object unsubscribed';\n    this.name = 'ObjectUnsubscribedError';\n    return this;\n  }\n\n  ObjectUnsubscribedErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return ObjectUnsubscribedErrorImpl;\n}();\n\nvar ObjectUnsubscribedError = ObjectUnsubscribedErrorImpl;\n/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\n\nvar SubjectSubscription = /*@__PURE__*/function (_super) {\n  __extends(SubjectSubscription, _super);\n\n  function SubjectSubscription(subject, subscriber) {\n    var _this = _super.call(this) || this;\n\n    _this.subject = subject;\n    _this.subscriber = subscriber;\n    _this.closed = false;\n    return _this;\n  }\n\n  SubjectSubscription.prototype.unsubscribe = function () {\n    if (this.closed) {\n      return;\n    }\n\n    this.closed = true;\n    var subject = this.subject;\n    var observers = subject.observers;\n    this.subject = null;\n\n    if (!observers || observers.length === 0 || subject.isStopped || subject.closed) {\n      return;\n    }\n\n    var subscriberIndex = observers.indexOf(this.subscriber);\n\n    if (subscriberIndex !== -1) {\n      observers.splice(subscriberIndex, 1);\n    }\n  };\n\n  return SubjectSubscription;\n}(Subscription);\n/** PURE_IMPORTS_START tslib,_Observable,_Subscriber,_Subscription,_util_ObjectUnsubscribedError,_SubjectSubscription,_internal_symbol_rxSubscriber PURE_IMPORTS_END */\n\n\nvar SubjectSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SubjectSubscriber, _super);\n\n  function SubjectSubscriber(destination) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.destination = destination;\n    return _this;\n  }\n\n  return SubjectSubscriber;\n}(Subscriber);\n\nvar Subject = /*@__PURE__*/function (_super) {\n  __extends(Subject, _super);\n\n  function Subject() {\n    var _this = _super.call(this) || this;\n\n    _this.observers = [];\n    _this.closed = false;\n    _this.isStopped = false;\n    _this.hasError = false;\n    _this.thrownError = null;\n    return _this;\n  }\n\n  Subject.prototype[rxSubscriber] = function () {\n    return new SubjectSubscriber(this);\n  };\n\n  Subject.prototype.lift = function (operator) {\n    var subject = new AnonymousSubject(this, this);\n    subject.operator = operator;\n    return subject;\n  };\n\n  Subject.prototype.next = function (value) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    if (!this.isStopped) {\n      var observers = this.observers;\n      var len = observers.length;\n      var copy = observers.slice();\n\n      for (var i = 0; i < len; i++) {\n        copy[i].next(value);\n      }\n    }\n  };\n\n  Subject.prototype.error = function (err) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    this.hasError = true;\n    this.thrownError = err;\n    this.isStopped = true;\n    var observers = this.observers;\n    var len = observers.length;\n    var copy = observers.slice();\n\n    for (var i = 0; i < len; i++) {\n      copy[i].error(err);\n    }\n\n    this.observers.length = 0;\n  };\n\n  Subject.prototype.complete = function () {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    this.isStopped = true;\n    var observers = this.observers;\n    var len = observers.length;\n    var copy = observers.slice();\n\n    for (var i = 0; i < len; i++) {\n      copy[i].complete();\n    }\n\n    this.observers.length = 0;\n  };\n\n  Subject.prototype.unsubscribe = function () {\n    this.isStopped = true;\n    this.closed = true;\n    this.observers = null;\n  };\n\n  Subject.prototype._trySubscribe = function (subscriber) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    } else {\n      return _super.prototype._trySubscribe.call(this, subscriber);\n    }\n  };\n\n  Subject.prototype._subscribe = function (subscriber) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    } else if (this.hasError) {\n      subscriber.error(this.thrownError);\n      return Subscription.EMPTY;\n    } else if (this.isStopped) {\n      subscriber.complete();\n      return Subscription.EMPTY;\n    } else {\n      this.observers.push(subscriber);\n      return new SubjectSubscription(this, subscriber);\n    }\n  };\n\n  Subject.prototype.asObservable = function () {\n    var observable = new Observable();\n    observable.source = this;\n    return observable;\n  };\n\n  Subject.create = function (destination, source) {\n    return new AnonymousSubject(destination, source);\n  };\n\n  return Subject;\n}(Observable);\n\nvar AnonymousSubject = /*@__PURE__*/function (_super) {\n  __extends(AnonymousSubject, _super);\n\n  function AnonymousSubject(destination, source) {\n    var _this = _super.call(this) || this;\n\n    _this.destination = destination;\n    _this.source = source;\n    return _this;\n  }\n\n  AnonymousSubject.prototype.next = function (value) {\n    var destination = this.destination;\n\n    if (destination && destination.next) {\n      destination.next(value);\n    }\n  };\n\n  AnonymousSubject.prototype.error = function (err) {\n    var destination = this.destination;\n\n    if (destination && destination.error) {\n      this.destination.error(err);\n    }\n  };\n\n  AnonymousSubject.prototype.complete = function () {\n    var destination = this.destination;\n\n    if (destination && destination.complete) {\n      this.destination.complete();\n    }\n  };\n\n  AnonymousSubject.prototype._subscribe = function (subscriber) {\n    var source = this.source;\n\n    if (source) {\n      return this.source.subscribe(subscriber);\n    } else {\n      return Subscription.EMPTY;\n    }\n  };\n\n  return AnonymousSubject;\n}(Subject);\n/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\n\n\nvar Action = /*@__PURE__*/function (_super) {\n  __extends(Action, _super);\n\n  function Action(scheduler, work) {\n    return _super.call(this) || this;\n  }\n\n  Action.prototype.schedule = function (state, delay) {\n    return this;\n  };\n\n  return Action;\n}(Subscription);\n/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */\n\n\nvar AsyncAction = /*@__PURE__*/function (_super) {\n  __extends(AsyncAction, _super);\n\n  function AsyncAction(scheduler, work) {\n    var _this = _super.call(this, scheduler, work) || this;\n\n    _this.scheduler = scheduler;\n    _this.work = work;\n    _this.pending = false;\n    return _this;\n  }\n\n  AsyncAction.prototype.schedule = function (state, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (this.closed) {\n      return this;\n    }\n\n    this.state = state;\n    var id = this.id;\n    var scheduler = this.scheduler;\n\n    if (id != null) {\n      this.id = this.recycleAsyncId(scheduler, id, delay);\n    }\n\n    this.pending = true;\n    this.delay = delay;\n    this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);\n    return this;\n  };\n\n  AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    return setInterval(scheduler.flush.bind(scheduler, this), delay);\n  };\n\n  AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (delay !== null && this.delay === delay && this.pending === false) {\n      return id;\n    }\n\n    clearInterval(id);\n    return undefined;\n  };\n\n  AsyncAction.prototype.execute = function (state, delay) {\n    if (this.closed) {\n      return new Error('executing a cancelled action');\n    }\n\n    this.pending = false;\n\n    var error = this._execute(state, delay);\n\n    if (error) {\n      return error;\n    } else if (this.pending === false && this.id != null) {\n      this.id = this.recycleAsyncId(this.scheduler, this.id, null);\n    }\n  };\n\n  AsyncAction.prototype._execute = function (state, delay) {\n    var errored = false;\n    var errorValue = undefined;\n\n    try {\n      this.work(state);\n    } catch (e) {\n      errored = true;\n      errorValue = !!e && e || new Error(e);\n    }\n\n    if (errored) {\n      this.unsubscribe();\n      return errorValue;\n    }\n  };\n\n  AsyncAction.prototype._unsubscribe = function () {\n    var id = this.id;\n    var scheduler = this.scheduler;\n    var actions = scheduler.actions;\n    var index = actions.indexOf(this);\n    this.work = null;\n    this.state = null;\n    this.pending = false;\n    this.scheduler = null;\n\n    if (index !== -1) {\n      actions.splice(index, 1);\n    }\n\n    if (id != null) {\n      this.id = this.recycleAsyncId(scheduler, id, null);\n    }\n\n    this.delay = null;\n  };\n\n  return AsyncAction;\n}(Action);\n\nvar Scheduler = /*@__PURE__*/function () {\n  function Scheduler(SchedulerAction, now) {\n    if (now === void 0) {\n      now = Scheduler.now;\n    }\n\n    this.SchedulerAction = SchedulerAction;\n    this.now = now;\n  }\n\n  Scheduler.prototype.schedule = function (work, delay, state) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    return new this.SchedulerAction(this, work).schedule(state, delay);\n  };\n\n  Scheduler.now = function () {\n    return Date.now();\n  };\n\n  return Scheduler;\n}();\n/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */\n\n\nvar AsyncScheduler = /*@__PURE__*/function (_super) {\n  __extends(AsyncScheduler, _super);\n\n  function AsyncScheduler(SchedulerAction, now) {\n    if (now === void 0) {\n      now = Scheduler.now;\n    }\n\n    var _this = _super.call(this, SchedulerAction, function () {\n      if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {\n        return AsyncScheduler.delegate.now();\n      } else {\n        return now();\n      }\n    }) || this;\n\n    _this.actions = [];\n    _this.active = false;\n    _this.scheduled = undefined;\n    return _this;\n  }\n\n  AsyncScheduler.prototype.schedule = function (work, delay, state) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {\n      return AsyncScheduler.delegate.schedule(work, delay, state);\n    } else {\n      return _super.prototype.schedule.call(this, work, delay, state);\n    }\n  };\n\n  AsyncScheduler.prototype.flush = function (action) {\n    var actions = this.actions;\n\n    if (this.active) {\n      actions.push(action);\n      return;\n    }\n\n    var error;\n    this.active = true;\n\n    do {\n      if (error = action.execute(action.state, action.delay)) {\n        break;\n      }\n    } while (action = actions.shift());\n\n    this.active = false;\n\n    if (error) {\n      while (action = actions.shift()) {\n        action.unsubscribe();\n      }\n\n      throw error;\n    }\n  };\n\n  return AsyncScheduler;\n}(Scheduler);\n/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */\n\n\nvar EMPTY = /*@__PURE__*/new Observable(function (subscriber) {\n  return subscriber.complete();\n});\n\nfunction empty$1(scheduler) {\n  return scheduler ? emptyScheduled(scheduler) : EMPTY;\n}\n\nfunction emptyScheduled(scheduler) {\n  return new Observable(function (subscriber) {\n    return scheduler.schedule(function () {\n      return subscriber.complete();\n    });\n  });\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar subscribeToArray = function (array) {\n  return function (subscriber) {\n    for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {\n      subscriber.next(array[i]);\n    }\n\n    subscriber.complete();\n  };\n};\n/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */\n\n\nfunction throwError(error, scheduler) {\n  if (!scheduler) {\n    return new Observable(function (subscriber) {\n      return subscriber.error(error);\n    });\n  } else {\n    return new Observable(function (subscriber) {\n      return scheduler.schedule(dispatch, 0, {\n        error: error,\n        subscriber: subscriber\n      });\n    });\n  }\n}\n\nfunction dispatch(_a) {\n  var error = _a.error,\n      subscriber = _a.subscriber;\n  subscriber.error(error);\n}\n/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */\n\n\nvar asyncScheduler = /*@__PURE__*/new AsyncScheduler(AsyncAction);\nvar async = asyncScheduler;\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar ArgumentOutOfRangeErrorImpl = /*@__PURE__*/function () {\n  function ArgumentOutOfRangeErrorImpl() {\n    Error.call(this);\n    this.message = 'argument out of range';\n    this.name = 'ArgumentOutOfRangeError';\n    return this;\n  }\n\n  ArgumentOutOfRangeErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return ArgumentOutOfRangeErrorImpl;\n}();\n\nvar ArgumentOutOfRangeError = ArgumentOutOfRangeErrorImpl;\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar TimeoutErrorImpl = /*@__PURE__*/function () {\n  function TimeoutErrorImpl() {\n    Error.call(this);\n    this.message = 'Timeout has occurred';\n    this.name = 'TimeoutError';\n    return this;\n  }\n\n  TimeoutErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return TimeoutErrorImpl;\n}();\n\nvar TimeoutError = TimeoutErrorImpl;\n/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */\n\nvar subscribeToPromise = function (promise) {\n  return function (subscriber) {\n    promise.then(function (value) {\n      if (!subscriber.closed) {\n        subscriber.next(value);\n        subscriber.complete();\n      }\n    }, function (err) {\n      return subscriber.error(err);\n    }).then(null, hostReportError);\n    return subscriber;\n  };\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction getSymbolIterator() {\n  if (typeof Symbol !== 'function' || !Symbol.iterator) {\n    return '@@iterator';\n  }\n\n  return Symbol.iterator;\n}\n\nvar iterator = /*@__PURE__*/getSymbolIterator();\n/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */\n\nvar subscribeToIterable = function (iterable) {\n  return function (subscriber) {\n    var iterator$1 = iterable[iterator]();\n\n    do {\n      var item = void 0;\n\n      try {\n        item = iterator$1.next();\n      } catch (err) {\n        subscriber.error(err);\n        return subscriber;\n      }\n\n      if (item.done) {\n        subscriber.complete();\n        break;\n      }\n\n      subscriber.next(item.value);\n\n      if (subscriber.closed) {\n        break;\n      }\n    } while (true);\n\n    if (typeof iterator$1.return === 'function') {\n      subscriber.add(function () {\n        if (iterator$1.return) {\n          iterator$1.return();\n        }\n      });\n    }\n\n    return subscriber;\n  };\n};\n/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */\n\n\nvar subscribeToObservable = function (obj) {\n  return function (subscriber) {\n    var obs = obj[observable]();\n\n    if (typeof obs.subscribe !== 'function') {\n      throw new TypeError('Provided object does not correctly implement Symbol.observable');\n    } else {\n      return obs.subscribe(subscriber);\n    }\n  };\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar isArrayLike = function (x) {\n  return x && typeof x.length === 'number' && typeof x !== 'function';\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isPromise(value) {\n  return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';\n}\n/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */\n\n\nvar subscribeTo = function (result) {\n  if (!!result && typeof result[observable] === 'function') {\n    return subscribeToObservable(result);\n  } else if (isArrayLike(result)) {\n    return subscribeToArray(result);\n  } else if (isPromise(result)) {\n    return subscribeToPromise(result);\n  } else if (!!result && typeof result[iterator] === 'function') {\n    return subscribeToIterable(result);\n  } else {\n    var value = isObject(result) ? 'an invalid object' : \"'\" + result + \"'\";\n    var msg = \"You provided \" + value + \" where a stream was expected.\" + ' You can provide an Observable, Promise, Array, or Iterable.';\n    throw new TypeError(msg);\n  }\n};\n/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_util_subscribeTo PURE_IMPORTS_END */\n\n\nvar SimpleInnerSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SimpleInnerSubscriber, _super);\n\n  function SimpleInnerSubscriber(parent) {\n    var _this = _super.call(this) || this;\n\n    _this.parent = parent;\n    return _this;\n  }\n\n  SimpleInnerSubscriber.prototype._next = function (value) {\n    this.parent.notifyNext(value);\n  };\n\n  SimpleInnerSubscriber.prototype._error = function (error) {\n    this.parent.notifyError(error);\n    this.unsubscribe();\n  };\n\n  SimpleInnerSubscriber.prototype._complete = function () {\n    this.parent.notifyComplete();\n    this.unsubscribe();\n  };\n\n  return SimpleInnerSubscriber;\n}(Subscriber);\n\nvar SimpleOuterSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SimpleOuterSubscriber, _super);\n\n  function SimpleOuterSubscriber() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  SimpleOuterSubscriber.prototype.notifyNext = function (innerValue) {\n    this.destination.next(innerValue);\n  };\n\n  SimpleOuterSubscriber.prototype.notifyError = function (err) {\n    this.destination.error(err);\n  };\n\n  SimpleOuterSubscriber.prototype.notifyComplete = function () {\n    this.destination.complete();\n  };\n\n  return SimpleOuterSubscriber;\n}(Subscriber);\n\nfunction innerSubscribe(result, innerSubscriber) {\n  if (innerSubscriber.closed) {\n    return undefined;\n  }\n\n  if (result instanceof Observable) {\n    return result.subscribe(innerSubscriber);\n  }\n\n  return subscribeTo(result)(innerSubscriber);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isDate(value) {\n  return value instanceof Date && !isNaN(+value);\n}\n/** PURE_IMPORTS_START tslib,_Subscriber,_util_ArgumentOutOfRangeError,_observable_empty PURE_IMPORTS_END */\n\n\nfunction take(count) {\n  return function (source) {\n    if (count === 0) {\n      return empty$1();\n    } else {\n      return source.lift(new TakeOperator(count));\n    }\n  };\n}\n\nvar TakeOperator = /*@__PURE__*/function () {\n  function TakeOperator(total) {\n    this.total = total;\n\n    if (this.total < 0) {\n      throw new ArgumentOutOfRangeError();\n    }\n  }\n\n  TakeOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new TakeSubscriber(subscriber, this.total));\n  };\n\n  return TakeOperator;\n}();\n\nvar TakeSubscriber = /*@__PURE__*/function (_super) {\n  __extends(TakeSubscriber, _super);\n\n  function TakeSubscriber(destination, total) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.total = total;\n    _this.count = 0;\n    return _this;\n  }\n\n  TakeSubscriber.prototype._next = function (value) {\n    var total = this.total;\n    var count = ++this.count;\n\n    if (count <= total) {\n      this.destination.next(value);\n\n      if (count === total) {\n        this.destination.complete();\n        this.unsubscribe();\n      }\n    }\n  };\n\n  return TakeSubscriber;\n}(Subscriber);\n/** PURE_IMPORTS_START tslib,_scheduler_async,_util_isDate,_innerSubscribe PURE_IMPORTS_END */\n\n\nfunction timeoutWith(due, withObservable, scheduler) {\n  if (scheduler === void 0) {\n    scheduler = async;\n  }\n\n  return function (source) {\n    var absoluteTimeout = isDate(due);\n    var waitFor = absoluteTimeout ? +due - scheduler.now() : Math.abs(due);\n    return source.lift(new TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler));\n  };\n}\n\nvar TimeoutWithOperator = /*@__PURE__*/function () {\n  function TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler) {\n    this.waitFor = waitFor;\n    this.absoluteTimeout = absoluteTimeout;\n    this.withObservable = withObservable;\n    this.scheduler = scheduler;\n  }\n\n  TimeoutWithOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new TimeoutWithSubscriber(subscriber, this.absoluteTimeout, this.waitFor, this.withObservable, this.scheduler));\n  };\n\n  return TimeoutWithOperator;\n}();\n\nvar TimeoutWithSubscriber = /*@__PURE__*/function (_super) {\n  __extends(TimeoutWithSubscriber, _super);\n\n  function TimeoutWithSubscriber(destination, absoluteTimeout, waitFor, withObservable, scheduler) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.absoluteTimeout = absoluteTimeout;\n    _this.waitFor = waitFor;\n    _this.withObservable = withObservable;\n    _this.scheduler = scheduler;\n\n    _this.scheduleTimeout();\n\n    return _this;\n  }\n\n  TimeoutWithSubscriber.dispatchTimeout = function (subscriber) {\n    var withObservable = subscriber.withObservable;\n\n    subscriber._unsubscribeAndRecycle();\n\n    subscriber.add(innerSubscribe(withObservable, new SimpleInnerSubscriber(subscriber)));\n  };\n\n  TimeoutWithSubscriber.prototype.scheduleTimeout = function () {\n    var action = this.action;\n\n    if (action) {\n      this.action = action.schedule(this, this.waitFor);\n    } else {\n      this.add(this.action = this.scheduler.schedule(TimeoutWithSubscriber.dispatchTimeout, this.waitFor, this));\n    }\n  };\n\n  TimeoutWithSubscriber.prototype._next = function (value) {\n    if (!this.absoluteTimeout) {\n      this.scheduleTimeout();\n    }\n\n    _super.prototype._next.call(this, value);\n  };\n\n  TimeoutWithSubscriber.prototype._unsubscribe = function () {\n    this.action = undefined;\n    this.scheduler = null;\n    this.withObservable = null;\n  };\n\n  return TimeoutWithSubscriber;\n}(SimpleOuterSubscriber);\n/** PURE_IMPORTS_START _scheduler_async,_util_TimeoutError,_timeoutWith,_observable_throwError PURE_IMPORTS_END */\n\n\nfunction timeout(due, scheduler) {\n  if (scheduler === void 0) {\n    scheduler = async;\n  }\n\n  return timeoutWith(due, throwError(new TimeoutError()), scheduler);\n}\n\nfunction configuration(config) {\n  if (this._destroyed) {\n    throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n  }\n\n  const casedScope = this._system === 'ethereum' ? config.scope.toLowerCase() : config.scope; // resolve previous configuration if exists\n\n  const previousConfiguration = this._configurations.get(casedScope);\n\n  previousConfiguration && previousConfiguration.subscription && previousConfiguration.subscription.next();\n  const subscription = new Subject(); // create emitter for transaction\n\n  const emitter = config.watchAddress ? {\n    emitter: createEmitter()\n  } : {};\n\n  this._configurations.set(casedScope, { ...config,\n    ...emitter,\n    subscription\n  });\n\n  this._sendMessage({\n    categoryCode: 'configs',\n    eventCode: 'put',\n    config\n  });\n\n  return new Promise((resolve, reject) => {\n    subscription.pipe(take(1), timeout(5000)).subscribe({\n      next: () => resolve({ ...emitter,\n        details: {\n          config\n        }\n      }),\n      error: error => {\n        const message = error.message === 'Timeout has occurred' ? `Configuration with scope: ${config.scope} has been sent to the Blocknative server, but has not received a reply within 5 seconds.` : error.message;\n\n        if (this._onerror) {\n          this._onerror({\n            message\n          });\n\n          resolve(`Error: ${message}`);\n        } else {\n          reject(message);\n        }\n      }\n    });\n  });\n}\n\nvar version = \"4.1.0\";\n\nfunction sendMessage(msg) {\n  if (this._queuedMessages.length > QUEUE_LIMIT) {\n    throw new Error(`Queue limit of ${QUEUE_LIMIT} messages has been reached.`);\n  }\n\n  this._queuedMessages.push(createEventLog.bind(this)(msg));\n\n  if (!this._processingQueue) {\n    this._processQueue();\n  }\n}\n\nasync function processQueue() {\n  this._processingQueue = true;\n\n  if (!this._connected) {\n    await waitForConnectionOpen.bind(this)();\n  }\n\n  while (this._queuedMessages.length > 0) {\n    // small wait to allow response from server to take affect\n    await wait(1);\n\n    if (this._waitToRetry !== null) {\n      // have been rate limited so wait\n      await this._waitToRetry;\n      this._waitToRetry = null;\n    }\n\n    const msg = this._queuedMessages.shift();\n\n    const delay = this._limitRules.duration / this._limitRules.points * 1000;\n    await wait(delay);\n\n    this._socket.send(msg);\n  }\n\n  this._processingQueue = false;\n  this._limitRules = DEFAULT_RATE_LIMIT_RULES;\n}\n\nfunction handleMessage(msg) {\n  const {\n    status,\n    reason,\n    event,\n    connectionId,\n    serverVersion,\n    retryMs,\n    limitRules,\n    blockedMsg,\n    dispatchTimestamp\n  } = JSON.parse(msg.data);\n\n  if (connectionId) {\n    if (isLocalStorageAvailable()) {\n      window.localStorage.setItem(this._storageKey, connectionId);\n    }\n\n    this._connectionId = connectionId;\n  } // handle any errors from the server\n\n\n  if (status === 'error') {\n    if (reason.includes('ratelimit') && !reason.match(/IP (PendingSimulation|Notification) ratelimit reached/)) {\n      this._waitToRetry = wait(retryMs);\n      this._limitRules = limitRules; // add blocked msg to the front of the queue\n\n      blockedMsg && this._queuedMessages.unshift(blockedMsg);\n      return;\n    }\n\n    if (reason.includes('not a valid API key')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    }\n\n    if (reason.includes('network not supported')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    }\n\n    if (reason.includes('maximum allowed amount')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle bitcoin txid error\n\n\n    if (reason.includes('invalid txid')) {\n      const reason = `${event.transaction.txid} is an invalid txid`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          transaction: event.transaction.txid\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle ethereum transaction hash error\n\n\n    if (reason.includes('invalid hash')) {\n      const reason = `${event.transaction.hash} is an invalid transaction hash`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          transaction: event.transaction.hash\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle general address error\n\n\n    if (reason.includes('invalid address')) {\n      const reason = `${event.account.address} is an invalid address`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle bitcoin specific address error\n\n\n    if (reason.includes('not a valid Bitcoin')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle ethereum specific address error\n\n\n    if (reason.includes('not a valid Ethereum')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle config error\n\n\n    if (event && event.config) {\n      const configuration = this._configurations.get(event.config.scope);\n\n      if (configuration && configuration.subscription) {\n        configuration.subscription.error({\n          message: reason\n        });\n      }\n\n      return;\n    } // throw error that comes back from the server without formatting the message\n\n\n    if (this._onerror) {\n      this._onerror({\n        message: reason\n      });\n\n      return;\n    } else {\n      throw new Error(reason);\n    }\n  }\n\n  if (event && event.config) {\n    const casedScope = this._system === 'ethereum' ? event.config.scope.toLowerCase() : event.config.scope;\n\n    const configuration = this._configurations.get(casedScope);\n\n    if (configuration && configuration.subscription) {\n      configuration.subscription.next();\n    }\n  }\n\n  if (event && event.transaction) {\n    const {\n      transaction,\n      eventCode,\n      contractCall,\n      timeStamp,\n      blockchain: {\n        system,\n        network\n      }\n    } = event; // flatten in to one object\n\n    const newState = this._system === 'ethereum' ? { ...transaction,\n      serverVersion,\n      eventCode,\n      timeStamp,\n      dispatchTimestamp,\n      system,\n      network,\n      contractCall\n    } : { ...transaction,\n      serverVersion,\n      eventCode,\n      timeStamp,\n      dispatchTimestamp,\n      system,\n      network\n    }; // ignore server echo and unsubscribe messages\n\n    if (serverEcho(eventCode) || transaction.status === 'unsubscribed') {\n      return;\n    } // replace originalHash to match webhook API\n\n\n    if (newState.originalHash) {\n      newState.replaceHash = newState.hash;\n      newState.hash = newState.originalHash;\n      delete newState.originalHash;\n    } // replace status to match webhook API\n\n\n    if (eventCode === 'txSpeedUp' && newState.status !== 'speedup') {\n      newState.status = 'speedup';\n    } // replace status to match webhook API\n\n\n    if (eventCode === 'txCancel' && newState.status !== 'cancel') {\n      newState.status = 'cancel';\n    } // handle change of hash in speedup and cancel events\n\n\n    if (eventCode === 'txSpeedUp' || eventCode === 'txCancel') {\n      this._watchedTransactions = this._watchedTransactions.map(tx => {\n        if (tx.hash === newState.replaceHash) {\n          // reassign hash parameter in transaction queue to new hash or txid\n          tx.hash = transaction.hash || transaction.txid;\n        }\n\n        return tx;\n      });\n    }\n\n    const watchedAddress = transaction.watchedAddress && this._system === 'ethereum' ? transaction.watchedAddress.toLowerCase() : transaction.watchedAddress;\n\n    if (watchedAddress) {\n      const accountObj = this._watchedAccounts.find(ac => ac.address === watchedAddress);\n\n      const accountEmitterResult = accountObj ? last(accountObj.emitters.map(emitter => emitter.emit(newState))) : false;\n\n      const configuration = this._configurations.get(watchedAddress);\n\n      const emitterResult = configuration && configuration.emitter ? configuration.emitter.emit(newState) || accountEmitterResult : accountEmitterResult;\n\n      this._transactionHandlers.forEach(handler => handler({\n        transaction: newState,\n        emitterResult\n      }));\n    } else {\n      const transactionObj = this._watchedTransactions.find(tx => tx.hash === newState.hash || newState.txid);\n\n      const emitterResult = transactionObj && transactionObj.emitter.emit(newState);\n\n      this._transactionHandlers.forEach(handler => handler({\n        transaction: newState,\n        emitterResult\n      })); // replace the emitter hash to the replace hash on replacement txs\n\n\n      if (newState.status === 'speedup' || newState.status === 'cancel') {\n        this._watchedTransactions = this._watchedTransactions.map(tx => {\n          if (tx.hash === newState.hash || newState.txid) {\n            return { ...tx,\n              hash: newState.replaceHash\n            };\n          }\n\n          return tx;\n        });\n      }\n    }\n  }\n}\n\nfunction createEventLog(msg) {\n  return JSON.stringify({\n    timeStamp: new Date().toISOString(),\n    dappId: this._dappId,\n    version,\n    appName: this._appName,\n    appVersion: this._appVersion,\n    blockchain: {\n      system: this._system,\n      network: networkName(this._system, this._networkId) || 'local'\n    },\n    ...msg\n  }, msg.categoryCode === 'configs' ? jsonPreserveUndefined : undefined);\n}\n\nfunction waitForConnectionOpen() {\n  return new Promise(resolve => {\n    const interval = setInterval(() => {\n      if (this._connected) {\n        setTimeout(resolve, 100);\n        clearInterval(interval);\n      }\n    });\n  });\n}\n\nfunction validateType(options) {\n  const {\n    name,\n    value,\n    type,\n    optional,\n    customValidation\n  } = options;\n\n  if (!optional && typeof value === 'undefined') {\n    throw new Error(`\"${name}\" is required`);\n  }\n\n  if (typeof value !== 'undefined' && (type === 'array' ? Array.isArray(type) : typeof value !== type)) {\n    throw new Error(`\"${name}\" must be of type: ${type}, received type: ${typeof value} from value: ${value}`);\n  }\n\n  if (typeof value !== 'undefined' && customValidation && !customValidation(value)) {\n    throw new Error(`\"${value}\" is not a valid \"${name}\"`);\n  }\n}\n\nfunction validateOptions(options) {\n  validateType({\n    name: 'sdk options',\n    value: options,\n    type: 'object'\n  });\n  const {\n    dappId,\n    system,\n    name,\n    appVersion,\n    networkId,\n    transactionHandlers,\n    apiUrl,\n    ws,\n    onopen,\n    ondown,\n    onreopen,\n    onerror,\n    onclose,\n    ...otherParams\n  } = options;\n  invalidParams(otherParams, ['dappId', 'system', 'name', 'appVersion', 'networkId', 'transactionHandlers', 'apiUrl', 'ws', 'onopen', 'ondown', 'onreopen', 'onerror', 'onclose'], 'Initialization Options');\n  validateType({\n    name: 'dappId',\n    value: dappId,\n    type: 'string'\n  });\n  validateType({\n    name: 'system',\n    value: system,\n    type: 'string',\n    optional: true,\n    customValidation: validSystem\n  });\n  validateType({\n    name: 'name',\n    value: name,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'appVersion',\n    value: appVersion,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'networkId',\n    value: networkId,\n    type: 'number'\n  });\n  validateType({\n    name: 'transactionHandler',\n    value: transactionHandlers,\n    type: 'array',\n    optional: true\n  });\n\n  if (transactionHandlers) {\n    transactionHandlers.forEach(handler => validateType({\n      name: 'transactionHandler',\n      value: handler,\n      type: 'function'\n    }));\n  }\n\n  validateType({\n    name: 'apiUrl',\n    value: apiUrl,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'ws',\n    value: ws,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onopen',\n    value: onopen,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'ondown',\n    value: ondown,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onreopen',\n    value: onreopen,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onerror',\n    value: onerror,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onclose',\n    value: onclose,\n    type: 'function',\n    optional: true\n  });\n}\n\nfunction validSystem(system) {\n  return !!networks[system];\n}\n\nfunction invalidParams(params, validParams, functionName) {\n  const invalid = Object.keys(params);\n\n  if (invalid.length > 0) {\n    throw new Error(`${invalid[0]} is not a valid parameter for ${functionName}, must be one of the following valid parameters: ${validParams.join(', ')}`);\n  }\n}\n\nconst DEFAULT_APP_NAME = 'unknown';\nconst DEFAULT_APP_VERSION = 'unknown';\nconst DEFAULT_SYSTEM = 'ethereum';\n\nclass Blocknative {\n  constructor(options) {\n    validateOptions(options);\n    const {\n      dappId,\n      system = DEFAULT_SYSTEM,\n      name = DEFAULT_APP_NAME,\n      appVersion = DEFAULT_APP_VERSION,\n      networkId,\n      transactionHandlers = [],\n      apiUrl,\n      ws,\n      onopen,\n      ondown,\n      onreopen,\n      onerror,\n      onclose\n    } = options; // override default timeout to allow for slow connections\n\n    const timeout = {\n      connectTimeout: 10000\n    };\n    const socket = new SturdyWebSocket(apiUrl || 'wss://api.blocknative.com/v0', ws ? {\n      wsConstructor: ws,\n      ...timeout\n    } : { ...timeout\n    });\n    socket.onopen = onOpen.bind(this, onopen);\n    socket.ondown = onDown.bind(this, ondown);\n    socket.onreopen = onReopen.bind(this, onreopen);\n    socket.onmessage = handleMessage.bind(this);\n\n    socket.onerror = error => onerror && onerror({\n      message: 'There was a WebSocket error',\n      error\n    });\n\n    socket.onclose = () => {\n      this._pingTimeout && clearInterval(this._pingTimeout);\n      onclose && onclose();\n    };\n\n    const storageKey = CryptoEs.SHA1(`${dappId} - ${name}`).toString();\n    const storedConnectionId = isLocalStorageAvailable() && window.localStorage.getItem(storageKey);\n    this._storageKey = storageKey;\n    this._connectionId = storedConnectionId || undefined;\n    this._dappId = dappId;\n    this._system = system;\n    this._networkId = networkId;\n    this._appName = name;\n    this._appVersion = appVersion;\n    this._transactionHandlers = transactionHandlers;\n    this._socket = socket;\n    this._connected = false;\n    this._sendMessage = sendMessage.bind(this);\n    this._watchedTransactions = [];\n    this._watchedAccounts = [];\n    this._configurations = new Map();\n    this._pingTimeout = undefined;\n    this._destroyed = false;\n    this._onerror = onerror;\n    this._queuedMessages = [];\n    this._limitRules = DEFAULT_RATE_LIMIT_RULES;\n    this._waitToRetry = null;\n    this._processingQueue = false;\n    this._processQueue = processQueue.bind(this);\n\n    if (this._socket.ws.on) {\n      this._heartbeat = () => {\n        this._pingTimeout && clearTimeout(this._pingTimeout);\n        this._pingTimeout = setTimeout(() => {\n          // terminate connection if we haven't heard the server ping after server timeout plus conservative latency delay\n          // Sturdy Websocket will handle the new connection logic\n          this._socket.ws.terminate();\n        }, 30000 + 1000);\n      };\n\n      this._socket.ws.on('ping', () => {\n        this._heartbeat && this._heartbeat();\n      });\n    } // public API\n\n\n    this.transaction = transaction.bind(this);\n    this.account = account.bind(this);\n    this.event = event.bind(this);\n    this.unsubscribe = unsubscribe.bind(this);\n    this.configuration = configuration.bind(this);\n\n    this.destroy = () => {\n      this._socket.close();\n\n      this._destroyed = true; // call onclose manually here as SturdyWebSocket doesn't currently work as expected\n      // https://github.com/dphilipson/sturdy-websocket/issues/5\n\n      this._socket.onclose();\n    };\n  }\n\n}\n\nfunction onOpen(handler) {\n  this._connected = true;\n  const msg = {\n    categoryCode: 'initialize',\n    eventCode: 'checkDappId',\n    connectionId: this._connectionId\n  }; // send this message directly rather than put in queue\n\n  this._socket.send(createEventLog.bind(this)(msg));\n\n  this._heartbeat && this._heartbeat();\n  handler && handler();\n}\n\nfunction onDown(handler, closeEvent) {\n  this._connected = false;\n\n  if (handler) {\n    handler(closeEvent);\n  }\n\n  this._pingTimeout && clearTimeout(this._pingTimeout);\n}\n\nasync function onReopen(handler) {\n  this._connected = true;\n  const msg = {\n    categoryCode: 'initialize',\n    eventCode: 'checkDappId',\n    connectionId: this._connectionId\n  };\n\n  this._socket.send(createEventLog.bind(this)(msg)); // re-register all configurations on re-connection\n\n\n  const configurations = Array.from(this._configurations.values()); // register global config first and wait for it to complete\n\n  const globalConfiguration = this._configurations.get('global');\n\n  if (globalConfiguration) {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const {\n        emitter,\n        subscription,\n        ...config\n      } = globalConfiguration;\n      await this.configuration(config);\n    } catch (error) {\n      console.warn('Error re-sending global configuration upon reconnection:', error);\n    }\n  }\n\n  const addressConfigurations = configurations.filter(_ref => {\n    let {\n      scope\n    } = _ref;\n    return scope !== 'global';\n  });\n  addressConfigurations.forEach(enhancedConfig => {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const {\n      emitter,\n      subscription,\n      ...config\n    } = enhancedConfig;\n\n    this._sendMessage({\n      categoryCode: 'configs',\n      eventCode: 'put',\n      config\n    });\n  }); // re-register all accounts to be watched by server upon\n  // re-connection as they don't get transferred over automatically\n  // to the new connection like tx hashes do\n\n  this._watchedAccounts.forEach(account => {\n    this._sendMessage({\n      eventCode: 'accountAddress',\n      categoryCode: 'watch',\n      account: {\n        address: account.address\n      }\n    });\n  });\n\n  if (handler) {\n    handler();\n  }\n\n  if (this._socket.ws && this._socket.ws.on) {\n    // need to re-register ping event since new connection\n    this._socket.ws.on('ping', () => {\n      this._heartbeat && this._heartbeat();\n    });\n\n    this._heartbeat();\n  }\n}\n\nexport default Blocknative;","map":{"version":3,"sources":["/Users/massimilianoalbini/Documents/gain-drop/node_modules/bnc-sdk/dist/esm/index.js"],"names":["SturdyWebSocket","CryptoEs","networks","bitcoin","ethereum","DEFAULT_RATE_LIMIT_RULES","points","duration","QUEUE_LIMIT","createEmitter","listeners","on","eventCode","listener","Error","off","emit","state","all","networkName","blockchain","id","serverEcho","last","arr","reverse","isAddress","addressOrHash","length","isTxid","wait","time","Promise","resolve","setTimeout","jsonPreserveUndefined","k","v","undefined","isLocalStorageAvailable","isSupported","window","testKey","localStorage","setItem","removeItem","err","transaction","hash","_destroyed","startTime","Date","now","emitter","_watchedTransactions","push","_system","status","newState","_sendMessage","categoryCode","transactionObj","details","emitState","emitterResult","_transactionHandlers","forEach","handler","bind","account","address","toLowerCase","existingAddressWatcher","_watchedAccounts","find","ac","emitters","event","eventObj","unsubscribe","txid","normalizedAddress","filter","tx","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","isFunction","x","_enable_super_gross_mode_that_will_cause_bad_things","config","useDeprecatedSynchronousErrorHandling","value","error","console","warn","stack","hostReportError","empty","closed","next","complete","isArray","isObject","UnsubscriptionErrorImpl","errors","call","message","map","i","toString","join","name","UnsubscriptionError","Subscription","_parentOrParents","_subscriptions","_ctorUnsubscribe","_unsubscribe","_a","remove","index","parent_1","e","flattenUnsubscriptionErrors","len","sub","concat","add","teardown","subscription","EMPTY","tmp","indexOf","subscriptions","subscriptionIndex","splice","reduce","errs","rxSubscriber","Symbol","Math","random","Subscriber","_super","destinationOrNext","_this","syncErrorValue","syncErrorThrown","syncErrorThrowable","isStopped","arguments","destination","SafeSubscriber","subscriber","_next","_error","_complete","_unsubscribeAndRecycle","_parentSubscriber","observerOrNext","context","_context","__tryOrUnsub","__tryOrSetError","wrappedComplete","fn","parent","canReportError","observer","closed_1","toSubscriber","nextOrObserver","observable","identity","pipeFromArray","fns","piped","input","prev","Observable","subscribe","_isScalar","_subscribe","lift","operator","source","sink","_trySubscribe","promiseCtor","getPromiseCtor","reject","pipe","operations","_i","toPromise","ObjectUnsubscribedErrorImpl","ObjectUnsubscribedError","SubjectSubscription","subject","observers","subscriberIndex","SubjectSubscriber","Subject","hasError","thrownError","AnonymousSubject","copy","slice","asObservable","Action","scheduler","work","schedule","delay","AsyncAction","pending","recycleAsyncId","requestAsyncId","setInterval","flush","clearInterval","execute","_execute","errored","errorValue","actions","Scheduler","SchedulerAction","AsyncScheduler","delegate","active","scheduled","action","shift","empty$1","emptyScheduled","subscribeToArray","array","throwError","dispatch","asyncScheduler","async","ArgumentOutOfRangeErrorImpl","ArgumentOutOfRangeError","TimeoutErrorImpl","TimeoutError","subscribeToPromise","promise","then","getSymbolIterator","iterator","subscribeToIterable","iterable","iterator$1","item","done","return","subscribeToObservable","obj","obs","TypeError","isArrayLike","isPromise","subscribeTo","result","msg","SimpleInnerSubscriber","notifyNext","notifyError","notifyComplete","SimpleOuterSubscriber","apply","innerValue","innerSubscribe","innerSubscriber","isDate","isNaN","take","count","TakeOperator","total","TakeSubscriber","timeoutWith","due","withObservable","absoluteTimeout","waitFor","abs","TimeoutWithOperator","TimeoutWithSubscriber","scheduleTimeout","dispatchTimeout","timeout","configuration","casedScope","scope","previousConfiguration","_configurations","get","watchAddress","set","_onerror","version","sendMessage","_queuedMessages","createEventLog","_processingQueue","_processQueue","processQueue","_connected","waitForConnectionOpen","_waitToRetry","_limitRules","_socket","send","handleMessage","reason","connectionId","serverVersion","retryMs","limitRules","blockedMsg","dispatchTimestamp","JSON","parse","data","_storageKey","_connectionId","includes","match","unshift","contractCall","timeStamp","system","network","originalHash","replaceHash","watchedAddress","accountObj","accountEmitterResult","stringify","toISOString","dappId","_dappId","appName","_appName","appVersion","_appVersion","_networkId","interval","validateType","options","type","optional","customValidation","validateOptions","networkId","transactionHandlers","apiUrl","ws","onopen","ondown","onreopen","onerror","onclose","otherParams","invalidParams","validSystem","params","validParams","functionName","invalid","keys","DEFAULT_APP_NAME","DEFAULT_APP_VERSION","DEFAULT_SYSTEM","Blocknative","connectTimeout","socket","wsConstructor","onOpen","onDown","onReopen","onmessage","_pingTimeout","storageKey","SHA1","storedConnectionId","getItem","Map","_heartbeat","clearTimeout","terminate","destroy","close","closeEvent","configurations","from","values","globalConfiguration","addressConfigurations","enhancedConfig"],"mappings":"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","sourcesContent":["import SturdyWebSocket from 'sturdy-websocket';\nimport CryptoEs from 'crypto-es';\nconst networks = {\n  bitcoin: {\n    '1': 'main',\n    '2': 'testnet'\n  },\n  ethereum: {\n    '1': 'main',\n    '3': 'ropsten',\n    '4': 'rinkeby',\n    '5': 'goerli',\n    '42': 'kovan',\n    '56': 'bsc-main',\n    '100': 'xdai',\n    '137': 'matic-main',\n    '250': 'fantom-main'\n  }\n};\nconst DEFAULT_RATE_LIMIT_RULES = {\n  points: 150,\n  duration: 1\n};\nconst QUEUE_LIMIT = 10000;\n\nfunction createEmitter() {\n  return {\n    listeners: {},\n    on: function (eventCode, listener) {\n      // check if valid eventCode\n      switch (eventCode) {\n        case 'txSent':\n        case 'txPool':\n        case 'txConfirmed':\n        case 'txSpeedUp':\n        case 'txCancel':\n        case 'txFailed':\n        case 'txDropped':\n        case 'txRequest':\n        case 'nsfFail':\n        case 'txRepeat':\n        case 'txAwaitingApproval':\n        case 'txConfirmReminder':\n        case 'txSendFail':\n        case 'txError':\n        case 'txUnderPriced':\n        case 'txPoolSimulation':\n        case 'all':\n          break;\n\n        default:\n          throw new Error(`${eventCode} is not a valid event code, for a list of valid event codes see: https://docs.blocknative.com/notify-sdk#event-codes`);\n      } // check that listener is a function\n\n\n      if (typeof listener !== 'function') {\n        throw new Error('Listener must be a function');\n      } // add listener for the eventCode\n\n\n      this.listeners[eventCode] = listener;\n    },\n    off: function (eventCode) {\n      delete this.listeners[eventCode];\n    },\n    emit: function (state) {\n      if (this.listeners[state.eventCode]) {\n        return this.listeners[state.eventCode](state);\n      }\n\n      if (this.listeners.all) {\n        return this.listeners.all(state);\n      }\n    }\n  };\n}\n\nfunction networkName(blockchain, id) {\n  return networks[blockchain][id];\n}\n\nfunction serverEcho(eventCode) {\n  switch (eventCode) {\n    case 'txRequest':\n    case 'nsfFail':\n    case 'txRepeat':\n    case 'txAwaitingApproval':\n    case 'txConfirmReminder':\n    case 'txSendFail':\n    case 'txError':\n    case 'txUnderPriced':\n    case 'txSent':\n      return true;\n\n    default:\n      return false;\n  }\n}\n\nfunction last(arr) {\n  return arr.reverse()[0];\n} // isAddress and isTxid are not meant to perform real validation,\n// just needs to work out if it is an address or a transaction id\n// the server will do more thorough validation\n\n\nfunction isAddress(blockchain, addressOrHash) {\n  switch (blockchain) {\n    case 'ethereum':\n      return addressOrHash.length === 42;\n\n    case 'bitcoin':\n      return addressOrHash.length !== 64;\n\n    default:\n      return false;\n  }\n}\n\nfunction isTxid(blockchain, addressOrHash) {\n  switch (blockchain) {\n    case 'ethereum':\n      return addressOrHash.length === 66;\n\n    case 'bitcoin':\n      return addressOrHash.length === 64;\n\n    default:\n      return false;\n  }\n}\n\nfunction wait(time) {\n  return new Promise(resolve => {\n    setTimeout(resolve, time);\n  });\n}\n\nconst jsonPreserveUndefined = (k, v) => v === undefined ? 'undefined' : v;\n/**\r\n * Tests if LocalStorage may be used. Accounts for environments where\r\n * LocalStorage is not supported, as well as those where it is blocked.\r\n *\r\n * @returns `true` if LocalStorage is supported and accessible, `false` otherwise.\r\n */\n\n\nfunction isLocalStorageAvailable() {\n  const isSupported = typeof window !== 'undefined' && 'localStorage' in window;\n\n  if (isSupported) {\n    const testKey = '__testLocalStorage';\n\n    try {\n      window.localStorage.setItem(testKey, '1');\n      window.localStorage.removeItem(testKey);\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  return false;\n}\n\nfunction transaction(hash, id) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.'); // create startTime for transaction\n\n  const startTime = Date.now(); // create emitter for transaction\n\n  const emitter = createEmitter(); // create eventCode for transaction\n\n  const eventCode = 'txSent'; // put in queue\n\n  this._watchedTransactions.push({\n    hash,\n    emitter\n  });\n\n  const transaction = {\n    [this._system === 'ethereum' ? 'hash' : 'txid']: hash,\n    id: id || hash,\n    startTime,\n    status: 'sent'\n  };\n  const newState = { ...transaction,\n    eventCode\n  }; // logEvent to server\n\n  this._sendMessage({\n    eventCode,\n    categoryCode: 'activeTransaction',\n    transaction\n  });\n\n  const transactionObj = {\n    details: newState,\n    emitter\n  };\n\n  function emitState() {\n    const emitterResult = emitter.emit(newState);\n\n    this._transactionHandlers.forEach(handler => handler({\n      transaction: newState,\n      emitterResult\n    }));\n  } // emit after delay to allow for listener to be registered\n\n\n  setTimeout(emitState.bind(this), 5);\n  return transactionObj;\n}\n\nfunction account(address) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.'); // lowercase the address if Ethereum\n\n  address = this._system === 'ethereum' ? address.toLowerCase() : address; // create emitter for transaction\n\n  const emitter = createEmitter(); // create eventCode for transaction\n\n  const eventCode = 'watch';\n\n  const existingAddressWatcher = this._watchedAccounts.find(ac => ac.address === address);\n\n  if (existingAddressWatcher) {\n    // add to existing emitters array\n    existingAddressWatcher.emitters.push(emitter);\n  } else {\n    // put in accounts queue\n    this._watchedAccounts.push({\n      address,\n      emitters: [emitter]\n    });\n  } // logEvent to server\n\n\n  this._sendMessage({\n    eventCode,\n    categoryCode: 'accountAddress',\n    account: {\n      address\n    }\n  });\n\n  return {\n    emitter,\n    details: {\n      address\n    }\n  };\n}\n\nfunction event(eventObj) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n\n  this._sendMessage(eventObj);\n}\n\nfunction unsubscribe(addressOrHash) {\n  if (this._destroyed) throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n  const address = isAddress(this._system, addressOrHash);\n  const txid = isTxid(this._system, addressOrHash); // check if it is an address or a hash\n\n  if (address) {\n    const normalizedAddress = this._system === 'ethereum' ? addressOrHash.toLowerCase() : addressOrHash; // remove address from accounts\n\n    this._watchedAccounts = this._watchedAccounts.filter(ac => ac.address !== normalizedAddress); // logEvent to server\n\n    this._sendMessage({\n      categoryCode: 'accountAddress',\n      eventCode: 'unwatch',\n      account: {\n        address: normalizedAddress\n      }\n    });\n  } else if (txid) {\n    // remove transaction from transactions\n    this._watchedTransactions = this._watchedTransactions.filter(tx => tx.hash !== addressOrHash); // logEvent to server\n\n    this._sendMessage({\n      categoryCode: 'activeTransaction',\n      eventCode: 'unwatch',\n      transaction: {\n        [this._system === 'ethereum' ? 'hash' : 'txid']: addressOrHash,\n        id: addressOrHash,\n        status: 'unsubscribed'\n      }\n    });\n  } else {\n    throw new Error(`Error trying to unsubscribe ${addressOrHash}: not a valid address or transaction id/hash`);\n  }\n}\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isFunction(x) {\n  return typeof x === 'function';\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar _enable_super_gross_mode_that_will_cause_bad_things = false;\nvar config = {\n  Promise: undefined,\n\n  set useDeprecatedSynchronousErrorHandling(value) {\n    if (value) {\n      var error = /*@__PURE__*/new Error();\n      /*@__PURE__*/\n\n      console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \\n' + error.stack);\n    }\n\n    _enable_super_gross_mode_that_will_cause_bad_things = value;\n  },\n\n  get useDeprecatedSynchronousErrorHandling() {\n    return _enable_super_gross_mode_that_will_cause_bad_things;\n  }\n\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nfunction hostReportError(err) {\n  setTimeout(function () {\n    throw err;\n  }, 0);\n}\n/** PURE_IMPORTS_START _config,_util_hostReportError PURE_IMPORTS_END */\n\n\nvar empty = {\n  closed: true,\n  next: function (value) {},\n  error: function (err) {\n    if (config.useDeprecatedSynchronousErrorHandling) {\n      throw err;\n    } else {\n      hostReportError(err);\n    }\n  },\n  complete: function () {}\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar isArray = /*@__PURE__*/function () {\n  return Array.isArray || function (x) {\n    return x && typeof x.length === 'number';\n  };\n}();\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isObject(x) {\n  return x !== null && typeof x === 'object';\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar UnsubscriptionErrorImpl = /*@__PURE__*/function () {\n  function UnsubscriptionErrorImpl(errors) {\n    Error.call(this);\n    this.message = errors ? errors.length + \" errors occurred during unsubscription:\\n\" + errors.map(function (err, i) {\n      return i + 1 + \") \" + err.toString();\n    }).join('\\n  ') : '';\n    this.name = 'UnsubscriptionError';\n    this.errors = errors;\n    return this;\n  }\n\n  UnsubscriptionErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return UnsubscriptionErrorImpl;\n}();\n\nvar UnsubscriptionError = UnsubscriptionErrorImpl;\n/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */\n\nvar Subscription = /*@__PURE__*/function () {\n  function Subscription(unsubscribe) {\n    this.closed = false;\n    this._parentOrParents = null;\n    this._subscriptions = null;\n\n    if (unsubscribe) {\n      this._ctorUnsubscribe = true;\n      this._unsubscribe = unsubscribe;\n    }\n  }\n\n  Subscription.prototype.unsubscribe = function () {\n    var errors;\n\n    if (this.closed) {\n      return;\n    }\n\n    var _a = this,\n        _parentOrParents = _a._parentOrParents,\n        _ctorUnsubscribe = _a._ctorUnsubscribe,\n        _unsubscribe = _a._unsubscribe,\n        _subscriptions = _a._subscriptions;\n\n    this.closed = true;\n    this._parentOrParents = null;\n    this._subscriptions = null;\n\n    if (_parentOrParents instanceof Subscription) {\n      _parentOrParents.remove(this);\n    } else if (_parentOrParents !== null) {\n      for (var index = 0; index < _parentOrParents.length; ++index) {\n        var parent_1 = _parentOrParents[index];\n        parent_1.remove(this);\n      }\n    }\n\n    if (isFunction(_unsubscribe)) {\n      if (_ctorUnsubscribe) {\n        this._unsubscribe = undefined;\n      }\n\n      try {\n        _unsubscribe.call(this);\n      } catch (e) {\n        errors = e instanceof UnsubscriptionError ? flattenUnsubscriptionErrors(e.errors) : [e];\n      }\n    }\n\n    if (isArray(_subscriptions)) {\n      var index = -1;\n      var len = _subscriptions.length;\n\n      while (++index < len) {\n        var sub = _subscriptions[index];\n\n        if (isObject(sub)) {\n          try {\n            sub.unsubscribe();\n          } catch (e) {\n            errors = errors || [];\n\n            if (e instanceof UnsubscriptionError) {\n              errors = errors.concat(flattenUnsubscriptionErrors(e.errors));\n            } else {\n              errors.push(e);\n            }\n          }\n        }\n      }\n    }\n\n    if (errors) {\n      throw new UnsubscriptionError(errors);\n    }\n  };\n\n  Subscription.prototype.add = function (teardown) {\n    var subscription = teardown;\n\n    if (!teardown) {\n      return Subscription.EMPTY;\n    }\n\n    switch (typeof teardown) {\n      case 'function':\n        subscription = new Subscription(teardown);\n\n      case 'object':\n        if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {\n          return subscription;\n        } else if (this.closed) {\n          subscription.unsubscribe();\n          return subscription;\n        } else if (!(subscription instanceof Subscription)) {\n          var tmp = subscription;\n          subscription = new Subscription();\n          subscription._subscriptions = [tmp];\n        }\n\n        break;\n\n      default:\n        {\n          throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n        }\n    }\n\n    var _parentOrParents = subscription._parentOrParents;\n\n    if (_parentOrParents === null) {\n      subscription._parentOrParents = this;\n    } else if (_parentOrParents instanceof Subscription) {\n      if (_parentOrParents === this) {\n        return subscription;\n      }\n\n      subscription._parentOrParents = [_parentOrParents, this];\n    } else if (_parentOrParents.indexOf(this) === -1) {\n      _parentOrParents.push(this);\n    } else {\n      return subscription;\n    }\n\n    var subscriptions = this._subscriptions;\n\n    if (subscriptions === null) {\n      this._subscriptions = [subscription];\n    } else {\n      subscriptions.push(subscription);\n    }\n\n    return subscription;\n  };\n\n  Subscription.prototype.remove = function (subscription) {\n    var subscriptions = this._subscriptions;\n\n    if (subscriptions) {\n      var subscriptionIndex = subscriptions.indexOf(subscription);\n\n      if (subscriptionIndex !== -1) {\n        subscriptions.splice(subscriptionIndex, 1);\n      }\n    }\n  };\n\n  Subscription.EMPTY = function (empty) {\n    empty.closed = true;\n    return empty;\n  }(new Subscription());\n\n  return Subscription;\n}();\n\nfunction flattenUnsubscriptionErrors(errors) {\n  return errors.reduce(function (errs, err) {\n    return errs.concat(err instanceof UnsubscriptionError ? err.errors : err);\n  }, []);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar rxSubscriber = /*@__PURE__*/function () {\n  return typeof Symbol === 'function' ? /*@__PURE__*/Symbol('rxSubscriber') : '@@rxSubscriber_' + /*@__PURE__*/Math.random();\n}();\n/** PURE_IMPORTS_START tslib,_util_isFunction,_Observer,_Subscription,_internal_symbol_rxSubscriber,_config,_util_hostReportError PURE_IMPORTS_END */\n\n\nvar Subscriber = /*@__PURE__*/function (_super) {\n  __extends(Subscriber, _super);\n\n  function Subscriber(destinationOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    _this.syncErrorValue = null;\n    _this.syncErrorThrown = false;\n    _this.syncErrorThrowable = false;\n    _this.isStopped = false;\n\n    switch (arguments.length) {\n      case 0:\n        _this.destination = empty;\n        break;\n\n      case 1:\n        if (!destinationOrNext) {\n          _this.destination = empty;\n          break;\n        }\n\n        if (typeof destinationOrNext === 'object') {\n          if (destinationOrNext instanceof Subscriber) {\n            _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;\n            _this.destination = destinationOrNext;\n            destinationOrNext.add(_this);\n          } else {\n            _this.syncErrorThrowable = true;\n            _this.destination = new SafeSubscriber(_this, destinationOrNext);\n          }\n\n          break;\n        }\n\n      default:\n        _this.syncErrorThrowable = true;\n        _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);\n        break;\n    }\n\n    return _this;\n  }\n\n  Subscriber.prototype[rxSubscriber] = function () {\n    return this;\n  };\n\n  Subscriber.create = function (next, error, complete) {\n    var subscriber = new Subscriber(next, error, complete);\n    subscriber.syncErrorThrowable = false;\n    return subscriber;\n  };\n\n  Subscriber.prototype.next = function (value) {\n    if (!this.isStopped) {\n      this._next(value);\n    }\n  };\n\n  Subscriber.prototype.error = function (err) {\n    if (!this.isStopped) {\n      this.isStopped = true;\n\n      this._error(err);\n    }\n  };\n\n  Subscriber.prototype.complete = function () {\n    if (!this.isStopped) {\n      this.isStopped = true;\n\n      this._complete();\n    }\n  };\n\n  Subscriber.prototype.unsubscribe = function () {\n    if (this.closed) {\n      return;\n    }\n\n    this.isStopped = true;\n\n    _super.prototype.unsubscribe.call(this);\n  };\n\n  Subscriber.prototype._next = function (value) {\n    this.destination.next(value);\n  };\n\n  Subscriber.prototype._error = function (err) {\n    this.destination.error(err);\n    this.unsubscribe();\n  };\n\n  Subscriber.prototype._complete = function () {\n    this.destination.complete();\n    this.unsubscribe();\n  };\n\n  Subscriber.prototype._unsubscribeAndRecycle = function () {\n    var _parentOrParents = this._parentOrParents;\n    this._parentOrParents = null;\n    this.unsubscribe();\n    this.closed = false;\n    this.isStopped = false;\n    this._parentOrParents = _parentOrParents;\n    return this;\n  };\n\n  return Subscriber;\n}(Subscription);\n\nvar SafeSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SafeSubscriber, _super);\n\n  function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {\n    var _this = _super.call(this) || this;\n\n    _this._parentSubscriber = _parentSubscriber;\n    var next;\n    var context = _this;\n\n    if (isFunction(observerOrNext)) {\n      next = observerOrNext;\n    } else if (observerOrNext) {\n      next = observerOrNext.next;\n      error = observerOrNext.error;\n      complete = observerOrNext.complete;\n\n      if (observerOrNext !== empty) {\n        context = Object.create(observerOrNext);\n\n        if (isFunction(context.unsubscribe)) {\n          _this.add(context.unsubscribe.bind(context));\n        }\n\n        context.unsubscribe = _this.unsubscribe.bind(_this);\n      }\n    }\n\n    _this._context = context;\n    _this._next = next;\n    _this._error = error;\n    _this._complete = complete;\n    return _this;\n  }\n\n  SafeSubscriber.prototype.next = function (value) {\n    if (!this.isStopped && this._next) {\n      var _parentSubscriber = this._parentSubscriber;\n\n      if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n        this.__tryOrUnsub(this._next, value);\n      } else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.error = function (err) {\n    if (!this.isStopped) {\n      var _parentSubscriber = this._parentSubscriber;\n      var useDeprecatedSynchronousErrorHandling = config.useDeprecatedSynchronousErrorHandling;\n\n      if (this._error) {\n        if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n          this.__tryOrUnsub(this._error, err);\n\n          this.unsubscribe();\n        } else {\n          this.__tryOrSetError(_parentSubscriber, this._error, err);\n\n          this.unsubscribe();\n        }\n      } else if (!_parentSubscriber.syncErrorThrowable) {\n        this.unsubscribe();\n\n        if (useDeprecatedSynchronousErrorHandling) {\n          throw err;\n        }\n\n        hostReportError(err);\n      } else {\n        if (useDeprecatedSynchronousErrorHandling) {\n          _parentSubscriber.syncErrorValue = err;\n          _parentSubscriber.syncErrorThrown = true;\n        } else {\n          hostReportError(err);\n        }\n\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.complete = function () {\n    var _this = this;\n\n    if (!this.isStopped) {\n      var _parentSubscriber = this._parentSubscriber;\n\n      if (this._complete) {\n        var wrappedComplete = function () {\n          return _this._complete.call(_this._context);\n        };\n\n        if (!config.useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {\n          this.__tryOrUnsub(wrappedComplete);\n\n          this.unsubscribe();\n        } else {\n          this.__tryOrSetError(_parentSubscriber, wrappedComplete);\n\n          this.unsubscribe();\n        }\n      } else {\n        this.unsubscribe();\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {\n    try {\n      fn.call(this._context, value);\n    } catch (err) {\n      this.unsubscribe();\n\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        throw err;\n      } else {\n        hostReportError(err);\n      }\n    }\n  };\n\n  SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {\n    if (!config.useDeprecatedSynchronousErrorHandling) {\n      throw new Error('bad call');\n    }\n\n    try {\n      fn.call(this._context, value);\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        parent.syncErrorValue = err;\n        parent.syncErrorThrown = true;\n        return true;\n      } else {\n        hostReportError(err);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  SafeSubscriber.prototype._unsubscribe = function () {\n    var _parentSubscriber = this._parentSubscriber;\n    this._context = null;\n    this._parentSubscriber = null;\n\n    _parentSubscriber.unsubscribe();\n  };\n\n  return SafeSubscriber;\n}(Subscriber);\n/** PURE_IMPORTS_START _Subscriber PURE_IMPORTS_END */\n\n\nfunction canReportError(observer) {\n  while (observer) {\n    var _a = observer,\n        closed_1 = _a.closed,\n        destination = _a.destination,\n        isStopped = _a.isStopped;\n\n    if (closed_1 || isStopped) {\n      return false;\n    } else if (destination && destination instanceof Subscriber) {\n      observer = destination;\n    } else {\n      observer = null;\n    }\n  }\n\n  return true;\n}\n/** PURE_IMPORTS_START _Subscriber,_symbol_rxSubscriber,_Observer PURE_IMPORTS_END */\n\n\nfunction toSubscriber(nextOrObserver, error, complete) {\n  if (nextOrObserver) {\n    if (nextOrObserver instanceof Subscriber) {\n      return nextOrObserver;\n    }\n\n    if (nextOrObserver[rxSubscriber]) {\n      return nextOrObserver[rxSubscriber]();\n    }\n  }\n\n  if (!nextOrObserver && !error && !complete) {\n    return new Subscriber(empty);\n  }\n\n  return new Subscriber(nextOrObserver, error, complete);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar observable = /*@__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction identity(x) {\n  return x;\n}\n/** PURE_IMPORTS_START _identity PURE_IMPORTS_END */\n\n\nfunction pipeFromArray(fns) {\n  if (fns.length === 0) {\n    return identity;\n  }\n\n  if (fns.length === 1) {\n    return fns[0];\n  }\n\n  return function piped(input) {\n    return fns.reduce(function (prev, fn) {\n      return fn(prev);\n    }, input);\n  };\n}\n/** PURE_IMPORTS_START _util_canReportError,_util_toSubscriber,_symbol_observable,_util_pipe,_config PURE_IMPORTS_END */\n\n\nvar Observable = /*@__PURE__*/function () {\n  function Observable(subscribe) {\n    this._isScalar = false;\n\n    if (subscribe) {\n      this._subscribe = subscribe;\n    }\n  }\n\n  Observable.prototype.lift = function (operator) {\n    var observable = new Observable();\n    observable.source = this;\n    observable.operator = operator;\n    return observable;\n  };\n\n  Observable.prototype.subscribe = function (observerOrNext, error, complete) {\n    var operator = this.operator;\n    var sink = toSubscriber(observerOrNext, error, complete);\n\n    if (operator) {\n      sink.add(operator.call(sink, this.source));\n    } else {\n      sink.add(this.source || config.useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable ? this._subscribe(sink) : this._trySubscribe(sink));\n    }\n\n    if (config.useDeprecatedSynchronousErrorHandling) {\n      if (sink.syncErrorThrowable) {\n        sink.syncErrorThrowable = false;\n\n        if (sink.syncErrorThrown) {\n          throw sink.syncErrorValue;\n        }\n      }\n    }\n\n    return sink;\n  };\n\n  Observable.prototype._trySubscribe = function (sink) {\n    try {\n      return this._subscribe(sink);\n    } catch (err) {\n      if (config.useDeprecatedSynchronousErrorHandling) {\n        sink.syncErrorThrown = true;\n        sink.syncErrorValue = err;\n      }\n\n      if (canReportError(sink)) {\n        sink.error(err);\n      } else {\n        console.warn(err);\n      }\n    }\n  };\n\n  Observable.prototype.forEach = function (next, promiseCtor) {\n    var _this = this;\n\n    promiseCtor = getPromiseCtor(promiseCtor);\n    return new promiseCtor(function (resolve, reject) {\n      var subscription;\n      subscription = _this.subscribe(function (value) {\n        try {\n          next(value);\n        } catch (err) {\n          reject(err);\n\n          if (subscription) {\n            subscription.unsubscribe();\n          }\n        }\n      }, reject, resolve);\n    });\n  };\n\n  Observable.prototype._subscribe = function (subscriber) {\n    var source = this.source;\n    return source && source.subscribe(subscriber);\n  };\n\n  Observable.prototype[observable] = function () {\n    return this;\n  };\n\n  Observable.prototype.pipe = function () {\n    var operations = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      operations[_i] = arguments[_i];\n    }\n\n    if (operations.length === 0) {\n      return this;\n    }\n\n    return pipeFromArray(operations)(this);\n  };\n\n  Observable.prototype.toPromise = function (promiseCtor) {\n    var _this = this;\n\n    promiseCtor = getPromiseCtor(promiseCtor);\n    return new promiseCtor(function (resolve, reject) {\n      var value;\n\n      _this.subscribe(function (x) {\n        return value = x;\n      }, function (err) {\n        return reject(err);\n      }, function () {\n        return resolve(value);\n      });\n    });\n  };\n\n  Observable.create = function (subscribe) {\n    return new Observable(subscribe);\n  };\n\n  return Observable;\n}();\n\nfunction getPromiseCtor(promiseCtor) {\n  if (!promiseCtor) {\n    promiseCtor = Promise;\n  }\n\n  if (!promiseCtor) {\n    throw new Error('no Promise impl found');\n  }\n\n  return promiseCtor;\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar ObjectUnsubscribedErrorImpl = /*@__PURE__*/function () {\n  function ObjectUnsubscribedErrorImpl() {\n    Error.call(this);\n    this.message = 'object unsubscribed';\n    this.name = 'ObjectUnsubscribedError';\n    return this;\n  }\n\n  ObjectUnsubscribedErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return ObjectUnsubscribedErrorImpl;\n}();\n\nvar ObjectUnsubscribedError = ObjectUnsubscribedErrorImpl;\n/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\n\nvar SubjectSubscription = /*@__PURE__*/function (_super) {\n  __extends(SubjectSubscription, _super);\n\n  function SubjectSubscription(subject, subscriber) {\n    var _this = _super.call(this) || this;\n\n    _this.subject = subject;\n    _this.subscriber = subscriber;\n    _this.closed = false;\n    return _this;\n  }\n\n  SubjectSubscription.prototype.unsubscribe = function () {\n    if (this.closed) {\n      return;\n    }\n\n    this.closed = true;\n    var subject = this.subject;\n    var observers = subject.observers;\n    this.subject = null;\n\n    if (!observers || observers.length === 0 || subject.isStopped || subject.closed) {\n      return;\n    }\n\n    var subscriberIndex = observers.indexOf(this.subscriber);\n\n    if (subscriberIndex !== -1) {\n      observers.splice(subscriberIndex, 1);\n    }\n  };\n\n  return SubjectSubscription;\n}(Subscription);\n/** PURE_IMPORTS_START tslib,_Observable,_Subscriber,_Subscription,_util_ObjectUnsubscribedError,_SubjectSubscription,_internal_symbol_rxSubscriber PURE_IMPORTS_END */\n\n\nvar SubjectSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SubjectSubscriber, _super);\n\n  function SubjectSubscriber(destination) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.destination = destination;\n    return _this;\n  }\n\n  return SubjectSubscriber;\n}(Subscriber);\n\nvar Subject = /*@__PURE__*/function (_super) {\n  __extends(Subject, _super);\n\n  function Subject() {\n    var _this = _super.call(this) || this;\n\n    _this.observers = [];\n    _this.closed = false;\n    _this.isStopped = false;\n    _this.hasError = false;\n    _this.thrownError = null;\n    return _this;\n  }\n\n  Subject.prototype[rxSubscriber] = function () {\n    return new SubjectSubscriber(this);\n  };\n\n  Subject.prototype.lift = function (operator) {\n    var subject = new AnonymousSubject(this, this);\n    subject.operator = operator;\n    return subject;\n  };\n\n  Subject.prototype.next = function (value) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    if (!this.isStopped) {\n      var observers = this.observers;\n      var len = observers.length;\n      var copy = observers.slice();\n\n      for (var i = 0; i < len; i++) {\n        copy[i].next(value);\n      }\n    }\n  };\n\n  Subject.prototype.error = function (err) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    this.hasError = true;\n    this.thrownError = err;\n    this.isStopped = true;\n    var observers = this.observers;\n    var len = observers.length;\n    var copy = observers.slice();\n\n    for (var i = 0; i < len; i++) {\n      copy[i].error(err);\n    }\n\n    this.observers.length = 0;\n  };\n\n  Subject.prototype.complete = function () {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n\n    this.isStopped = true;\n    var observers = this.observers;\n    var len = observers.length;\n    var copy = observers.slice();\n\n    for (var i = 0; i < len; i++) {\n      copy[i].complete();\n    }\n\n    this.observers.length = 0;\n  };\n\n  Subject.prototype.unsubscribe = function () {\n    this.isStopped = true;\n    this.closed = true;\n    this.observers = null;\n  };\n\n  Subject.prototype._trySubscribe = function (subscriber) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    } else {\n      return _super.prototype._trySubscribe.call(this, subscriber);\n    }\n  };\n\n  Subject.prototype._subscribe = function (subscriber) {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    } else if (this.hasError) {\n      subscriber.error(this.thrownError);\n      return Subscription.EMPTY;\n    } else if (this.isStopped) {\n      subscriber.complete();\n      return Subscription.EMPTY;\n    } else {\n      this.observers.push(subscriber);\n      return new SubjectSubscription(this, subscriber);\n    }\n  };\n\n  Subject.prototype.asObservable = function () {\n    var observable = new Observable();\n    observable.source = this;\n    return observable;\n  };\n\n  Subject.create = function (destination, source) {\n    return new AnonymousSubject(destination, source);\n  };\n\n  return Subject;\n}(Observable);\n\nvar AnonymousSubject = /*@__PURE__*/function (_super) {\n  __extends(AnonymousSubject, _super);\n\n  function AnonymousSubject(destination, source) {\n    var _this = _super.call(this) || this;\n\n    _this.destination = destination;\n    _this.source = source;\n    return _this;\n  }\n\n  AnonymousSubject.prototype.next = function (value) {\n    var destination = this.destination;\n\n    if (destination && destination.next) {\n      destination.next(value);\n    }\n  };\n\n  AnonymousSubject.prototype.error = function (err) {\n    var destination = this.destination;\n\n    if (destination && destination.error) {\n      this.destination.error(err);\n    }\n  };\n\n  AnonymousSubject.prototype.complete = function () {\n    var destination = this.destination;\n\n    if (destination && destination.complete) {\n      this.destination.complete();\n    }\n  };\n\n  AnonymousSubject.prototype._subscribe = function (subscriber) {\n    var source = this.source;\n\n    if (source) {\n      return this.source.subscribe(subscriber);\n    } else {\n      return Subscription.EMPTY;\n    }\n  };\n\n  return AnonymousSubject;\n}(Subject);\n/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\n\n\nvar Action = /*@__PURE__*/function (_super) {\n  __extends(Action, _super);\n\n  function Action(scheduler, work) {\n    return _super.call(this) || this;\n  }\n\n  Action.prototype.schedule = function (state, delay) {\n    return this;\n  };\n\n  return Action;\n}(Subscription);\n/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */\n\n\nvar AsyncAction = /*@__PURE__*/function (_super) {\n  __extends(AsyncAction, _super);\n\n  function AsyncAction(scheduler, work) {\n    var _this = _super.call(this, scheduler, work) || this;\n\n    _this.scheduler = scheduler;\n    _this.work = work;\n    _this.pending = false;\n    return _this;\n  }\n\n  AsyncAction.prototype.schedule = function (state, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (this.closed) {\n      return this;\n    }\n\n    this.state = state;\n    var id = this.id;\n    var scheduler = this.scheduler;\n\n    if (id != null) {\n      this.id = this.recycleAsyncId(scheduler, id, delay);\n    }\n\n    this.pending = true;\n    this.delay = delay;\n    this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);\n    return this;\n  };\n\n  AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    return setInterval(scheduler.flush.bind(scheduler, this), delay);\n  };\n\n  AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (delay !== null && this.delay === delay && this.pending === false) {\n      return id;\n    }\n\n    clearInterval(id);\n    return undefined;\n  };\n\n  AsyncAction.prototype.execute = function (state, delay) {\n    if (this.closed) {\n      return new Error('executing a cancelled action');\n    }\n\n    this.pending = false;\n\n    var error = this._execute(state, delay);\n\n    if (error) {\n      return error;\n    } else if (this.pending === false && this.id != null) {\n      this.id = this.recycleAsyncId(this.scheduler, this.id, null);\n    }\n  };\n\n  AsyncAction.prototype._execute = function (state, delay) {\n    var errored = false;\n    var errorValue = undefined;\n\n    try {\n      this.work(state);\n    } catch (e) {\n      errored = true;\n      errorValue = !!e && e || new Error(e);\n    }\n\n    if (errored) {\n      this.unsubscribe();\n      return errorValue;\n    }\n  };\n\n  AsyncAction.prototype._unsubscribe = function () {\n    var id = this.id;\n    var scheduler = this.scheduler;\n    var actions = scheduler.actions;\n    var index = actions.indexOf(this);\n    this.work = null;\n    this.state = null;\n    this.pending = false;\n    this.scheduler = null;\n\n    if (index !== -1) {\n      actions.splice(index, 1);\n    }\n\n    if (id != null) {\n      this.id = this.recycleAsyncId(scheduler, id, null);\n    }\n\n    this.delay = null;\n  };\n\n  return AsyncAction;\n}(Action);\n\nvar Scheduler = /*@__PURE__*/function () {\n  function Scheduler(SchedulerAction, now) {\n    if (now === void 0) {\n      now = Scheduler.now;\n    }\n\n    this.SchedulerAction = SchedulerAction;\n    this.now = now;\n  }\n\n  Scheduler.prototype.schedule = function (work, delay, state) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    return new this.SchedulerAction(this, work).schedule(state, delay);\n  };\n\n  Scheduler.now = function () {\n    return Date.now();\n  };\n\n  return Scheduler;\n}();\n/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */\n\n\nvar AsyncScheduler = /*@__PURE__*/function (_super) {\n  __extends(AsyncScheduler, _super);\n\n  function AsyncScheduler(SchedulerAction, now) {\n    if (now === void 0) {\n      now = Scheduler.now;\n    }\n\n    var _this = _super.call(this, SchedulerAction, function () {\n      if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {\n        return AsyncScheduler.delegate.now();\n      } else {\n        return now();\n      }\n    }) || this;\n\n    _this.actions = [];\n    _this.active = false;\n    _this.scheduled = undefined;\n    return _this;\n  }\n\n  AsyncScheduler.prototype.schedule = function (work, delay, state) {\n    if (delay === void 0) {\n      delay = 0;\n    }\n\n    if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {\n      return AsyncScheduler.delegate.schedule(work, delay, state);\n    } else {\n      return _super.prototype.schedule.call(this, work, delay, state);\n    }\n  };\n\n  AsyncScheduler.prototype.flush = function (action) {\n    var actions = this.actions;\n\n    if (this.active) {\n      actions.push(action);\n      return;\n    }\n\n    var error;\n    this.active = true;\n\n    do {\n      if (error = action.execute(action.state, action.delay)) {\n        break;\n      }\n    } while (action = actions.shift());\n\n    this.active = false;\n\n    if (error) {\n      while (action = actions.shift()) {\n        action.unsubscribe();\n      }\n\n      throw error;\n    }\n  };\n\n  return AsyncScheduler;\n}(Scheduler);\n/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */\n\n\nvar EMPTY = /*@__PURE__*/new Observable(function (subscriber) {\n  return subscriber.complete();\n});\n\nfunction empty$1(scheduler) {\n  return scheduler ? emptyScheduled(scheduler) : EMPTY;\n}\n\nfunction emptyScheduled(scheduler) {\n  return new Observable(function (subscriber) {\n    return scheduler.schedule(function () {\n      return subscriber.complete();\n    });\n  });\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar subscribeToArray = function (array) {\n  return function (subscriber) {\n    for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {\n      subscriber.next(array[i]);\n    }\n\n    subscriber.complete();\n  };\n};\n/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */\n\n\nfunction throwError(error, scheduler) {\n  if (!scheduler) {\n    return new Observable(function (subscriber) {\n      return subscriber.error(error);\n    });\n  } else {\n    return new Observable(function (subscriber) {\n      return scheduler.schedule(dispatch, 0, {\n        error: error,\n        subscriber: subscriber\n      });\n    });\n  }\n}\n\nfunction dispatch(_a) {\n  var error = _a.error,\n      subscriber = _a.subscriber;\n  subscriber.error(error);\n}\n/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */\n\n\nvar asyncScheduler = /*@__PURE__*/new AsyncScheduler(AsyncAction);\nvar async = asyncScheduler;\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar ArgumentOutOfRangeErrorImpl = /*@__PURE__*/function () {\n  function ArgumentOutOfRangeErrorImpl() {\n    Error.call(this);\n    this.message = 'argument out of range';\n    this.name = 'ArgumentOutOfRangeError';\n    return this;\n  }\n\n  ArgumentOutOfRangeErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return ArgumentOutOfRangeErrorImpl;\n}();\n\nvar ArgumentOutOfRangeError = ArgumentOutOfRangeErrorImpl;\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\nvar TimeoutErrorImpl = /*@__PURE__*/function () {\n  function TimeoutErrorImpl() {\n    Error.call(this);\n    this.message = 'Timeout has occurred';\n    this.name = 'TimeoutError';\n    return this;\n  }\n\n  TimeoutErrorImpl.prototype = /*@__PURE__*/Object.create(Error.prototype);\n  return TimeoutErrorImpl;\n}();\n\nvar TimeoutError = TimeoutErrorImpl;\n/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */\n\nvar subscribeToPromise = function (promise) {\n  return function (subscriber) {\n    promise.then(function (value) {\n      if (!subscriber.closed) {\n        subscriber.next(value);\n        subscriber.complete();\n      }\n    }, function (err) {\n      return subscriber.error(err);\n    }).then(null, hostReportError);\n    return subscriber;\n  };\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction getSymbolIterator() {\n  if (typeof Symbol !== 'function' || !Symbol.iterator) {\n    return '@@iterator';\n  }\n\n  return Symbol.iterator;\n}\n\nvar iterator = /*@__PURE__*/getSymbolIterator();\n/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */\n\nvar subscribeToIterable = function (iterable) {\n  return function (subscriber) {\n    var iterator$1 = iterable[iterator]();\n\n    do {\n      var item = void 0;\n\n      try {\n        item = iterator$1.next();\n      } catch (err) {\n        subscriber.error(err);\n        return subscriber;\n      }\n\n      if (item.done) {\n        subscriber.complete();\n        break;\n      }\n\n      subscriber.next(item.value);\n\n      if (subscriber.closed) {\n        break;\n      }\n    } while (true);\n\n    if (typeof iterator$1.return === 'function') {\n      subscriber.add(function () {\n        if (iterator$1.return) {\n          iterator$1.return();\n        }\n      });\n    }\n\n    return subscriber;\n  };\n};\n/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */\n\n\nvar subscribeToObservable = function (obj) {\n  return function (subscriber) {\n    var obs = obj[observable]();\n\n    if (typeof obs.subscribe !== 'function') {\n      throw new TypeError('Provided object does not correctly implement Symbol.observable');\n    } else {\n      return obs.subscribe(subscriber);\n    }\n  };\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nvar isArrayLike = function (x) {\n  return x && typeof x.length === 'number' && typeof x !== 'function';\n};\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isPromise(value) {\n  return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';\n}\n/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */\n\n\nvar subscribeTo = function (result) {\n  if (!!result && typeof result[observable] === 'function') {\n    return subscribeToObservable(result);\n  } else if (isArrayLike(result)) {\n    return subscribeToArray(result);\n  } else if (isPromise(result)) {\n    return subscribeToPromise(result);\n  } else if (!!result && typeof result[iterator] === 'function') {\n    return subscribeToIterable(result);\n  } else {\n    var value = isObject(result) ? 'an invalid object' : \"'\" + result + \"'\";\n    var msg = \"You provided \" + value + \" where a stream was expected.\" + ' You can provide an Observable, Promise, Array, or Iterable.';\n    throw new TypeError(msg);\n  }\n};\n/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_util_subscribeTo PURE_IMPORTS_END */\n\n\nvar SimpleInnerSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SimpleInnerSubscriber, _super);\n\n  function SimpleInnerSubscriber(parent) {\n    var _this = _super.call(this) || this;\n\n    _this.parent = parent;\n    return _this;\n  }\n\n  SimpleInnerSubscriber.prototype._next = function (value) {\n    this.parent.notifyNext(value);\n  };\n\n  SimpleInnerSubscriber.prototype._error = function (error) {\n    this.parent.notifyError(error);\n    this.unsubscribe();\n  };\n\n  SimpleInnerSubscriber.prototype._complete = function () {\n    this.parent.notifyComplete();\n    this.unsubscribe();\n  };\n\n  return SimpleInnerSubscriber;\n}(Subscriber);\n\nvar SimpleOuterSubscriber = /*@__PURE__*/function (_super) {\n  __extends(SimpleOuterSubscriber, _super);\n\n  function SimpleOuterSubscriber() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  SimpleOuterSubscriber.prototype.notifyNext = function (innerValue) {\n    this.destination.next(innerValue);\n  };\n\n  SimpleOuterSubscriber.prototype.notifyError = function (err) {\n    this.destination.error(err);\n  };\n\n  SimpleOuterSubscriber.prototype.notifyComplete = function () {\n    this.destination.complete();\n  };\n\n  return SimpleOuterSubscriber;\n}(Subscriber);\n\nfunction innerSubscribe(result, innerSubscriber) {\n  if (innerSubscriber.closed) {\n    return undefined;\n  }\n\n  if (result instanceof Observable) {\n    return result.subscribe(innerSubscriber);\n  }\n\n  return subscribeTo(result)(innerSubscriber);\n}\n/** PURE_IMPORTS_START  PURE_IMPORTS_END */\n\n\nfunction isDate(value) {\n  return value instanceof Date && !isNaN(+value);\n}\n/** PURE_IMPORTS_START tslib,_Subscriber,_util_ArgumentOutOfRangeError,_observable_empty PURE_IMPORTS_END */\n\n\nfunction take(count) {\n  return function (source) {\n    if (count === 0) {\n      return empty$1();\n    } else {\n      return source.lift(new TakeOperator(count));\n    }\n  };\n}\n\nvar TakeOperator = /*@__PURE__*/function () {\n  function TakeOperator(total) {\n    this.total = total;\n\n    if (this.total < 0) {\n      throw new ArgumentOutOfRangeError();\n    }\n  }\n\n  TakeOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new TakeSubscriber(subscriber, this.total));\n  };\n\n  return TakeOperator;\n}();\n\nvar TakeSubscriber = /*@__PURE__*/function (_super) {\n  __extends(TakeSubscriber, _super);\n\n  function TakeSubscriber(destination, total) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.total = total;\n    _this.count = 0;\n    return _this;\n  }\n\n  TakeSubscriber.prototype._next = function (value) {\n    var total = this.total;\n    var count = ++this.count;\n\n    if (count <= total) {\n      this.destination.next(value);\n\n      if (count === total) {\n        this.destination.complete();\n        this.unsubscribe();\n      }\n    }\n  };\n\n  return TakeSubscriber;\n}(Subscriber);\n/** PURE_IMPORTS_START tslib,_scheduler_async,_util_isDate,_innerSubscribe PURE_IMPORTS_END */\n\n\nfunction timeoutWith(due, withObservable, scheduler) {\n  if (scheduler === void 0) {\n    scheduler = async;\n  }\n\n  return function (source) {\n    var absoluteTimeout = isDate(due);\n    var waitFor = absoluteTimeout ? +due - scheduler.now() : Math.abs(due);\n    return source.lift(new TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler));\n  };\n}\n\nvar TimeoutWithOperator = /*@__PURE__*/function () {\n  function TimeoutWithOperator(waitFor, absoluteTimeout, withObservable, scheduler) {\n    this.waitFor = waitFor;\n    this.absoluteTimeout = absoluteTimeout;\n    this.withObservable = withObservable;\n    this.scheduler = scheduler;\n  }\n\n  TimeoutWithOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new TimeoutWithSubscriber(subscriber, this.absoluteTimeout, this.waitFor, this.withObservable, this.scheduler));\n  };\n\n  return TimeoutWithOperator;\n}();\n\nvar TimeoutWithSubscriber = /*@__PURE__*/function (_super) {\n  __extends(TimeoutWithSubscriber, _super);\n\n  function TimeoutWithSubscriber(destination, absoluteTimeout, waitFor, withObservable, scheduler) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.absoluteTimeout = absoluteTimeout;\n    _this.waitFor = waitFor;\n    _this.withObservable = withObservable;\n    _this.scheduler = scheduler;\n\n    _this.scheduleTimeout();\n\n    return _this;\n  }\n\n  TimeoutWithSubscriber.dispatchTimeout = function (subscriber) {\n    var withObservable = subscriber.withObservable;\n\n    subscriber._unsubscribeAndRecycle();\n\n    subscriber.add(innerSubscribe(withObservable, new SimpleInnerSubscriber(subscriber)));\n  };\n\n  TimeoutWithSubscriber.prototype.scheduleTimeout = function () {\n    var action = this.action;\n\n    if (action) {\n      this.action = action.schedule(this, this.waitFor);\n    } else {\n      this.add(this.action = this.scheduler.schedule(TimeoutWithSubscriber.dispatchTimeout, this.waitFor, this));\n    }\n  };\n\n  TimeoutWithSubscriber.prototype._next = function (value) {\n    if (!this.absoluteTimeout) {\n      this.scheduleTimeout();\n    }\n\n    _super.prototype._next.call(this, value);\n  };\n\n  TimeoutWithSubscriber.prototype._unsubscribe = function () {\n    this.action = undefined;\n    this.scheduler = null;\n    this.withObservable = null;\n  };\n\n  return TimeoutWithSubscriber;\n}(SimpleOuterSubscriber);\n/** PURE_IMPORTS_START _scheduler_async,_util_TimeoutError,_timeoutWith,_observable_throwError PURE_IMPORTS_END */\n\n\nfunction timeout(due, scheduler) {\n  if (scheduler === void 0) {\n    scheduler = async;\n  }\n\n  return timeoutWith(due, throwError(new TimeoutError()), scheduler);\n}\n\nfunction configuration(config) {\n  if (this._destroyed) {\n    throw new Error('The WebSocket instance has been destroyed, re-initialize to continue making requests.');\n  }\n\n  const casedScope = this._system === 'ethereum' ? config.scope.toLowerCase() : config.scope; // resolve previous configuration if exists\n\n  const previousConfiguration = this._configurations.get(casedScope);\n\n  previousConfiguration && previousConfiguration.subscription && previousConfiguration.subscription.next();\n  const subscription = new Subject(); // create emitter for transaction\n\n  const emitter = config.watchAddress ? {\n    emitter: createEmitter()\n  } : {};\n\n  this._configurations.set(casedScope, { ...config,\n    ...emitter,\n    subscription\n  });\n\n  this._sendMessage({\n    categoryCode: 'configs',\n    eventCode: 'put',\n    config\n  });\n\n  return new Promise((resolve, reject) => {\n    subscription.pipe(take(1), timeout(5000)).subscribe({\n      next: () => resolve({ ...emitter,\n        details: {\n          config\n        }\n      }),\n      error: error => {\n        const message = error.message === 'Timeout has occurred' ? `Configuration with scope: ${config.scope} has been sent to the Blocknative server, but has not received a reply within 5 seconds.` : error.message;\n\n        if (this._onerror) {\n          this._onerror({\n            message\n          });\n\n          resolve(`Error: ${message}`);\n        } else {\n          reject(message);\n        }\n      }\n    });\n  });\n}\n\nvar version = \"4.1.0\";\n\nfunction sendMessage(msg) {\n  if (this._queuedMessages.length > QUEUE_LIMIT) {\n    throw new Error(`Queue limit of ${QUEUE_LIMIT} messages has been reached.`);\n  }\n\n  this._queuedMessages.push(createEventLog.bind(this)(msg));\n\n  if (!this._processingQueue) {\n    this._processQueue();\n  }\n}\n\nasync function processQueue() {\n  this._processingQueue = true;\n\n  if (!this._connected) {\n    await waitForConnectionOpen.bind(this)();\n  }\n\n  while (this._queuedMessages.length > 0) {\n    // small wait to allow response from server to take affect\n    await wait(1);\n\n    if (this._waitToRetry !== null) {\n      // have been rate limited so wait\n      await this._waitToRetry;\n      this._waitToRetry = null;\n    }\n\n    const msg = this._queuedMessages.shift();\n\n    const delay = this._limitRules.duration / this._limitRules.points * 1000;\n    await wait(delay);\n\n    this._socket.send(msg);\n  }\n\n  this._processingQueue = false;\n  this._limitRules = DEFAULT_RATE_LIMIT_RULES;\n}\n\nfunction handleMessage(msg) {\n  const {\n    status,\n    reason,\n    event,\n    connectionId,\n    serverVersion,\n    retryMs,\n    limitRules,\n    blockedMsg,\n    dispatchTimestamp\n  } = JSON.parse(msg.data);\n\n  if (connectionId) {\n    if (isLocalStorageAvailable()) {\n      window.localStorage.setItem(this._storageKey, connectionId);\n    }\n\n    this._connectionId = connectionId;\n  } // handle any errors from the server\n\n\n  if (status === 'error') {\n    if (reason.includes('ratelimit') && !reason.match(/IP (PendingSimulation|Notification) ratelimit reached/)) {\n      this._waitToRetry = wait(retryMs);\n      this._limitRules = limitRules; // add blocked msg to the front of the queue\n\n      blockedMsg && this._queuedMessages.unshift(blockedMsg);\n      return;\n    }\n\n    if (reason.includes('not a valid API key')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    }\n\n    if (reason.includes('network not supported')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    }\n\n    if (reason.includes('maximum allowed amount')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle bitcoin txid error\n\n\n    if (reason.includes('invalid txid')) {\n      const reason = `${event.transaction.txid} is an invalid txid`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          transaction: event.transaction.txid\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle ethereum transaction hash error\n\n\n    if (reason.includes('invalid hash')) {\n      const reason = `${event.transaction.hash} is an invalid transaction hash`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          transaction: event.transaction.hash\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle general address error\n\n\n    if (reason.includes('invalid address')) {\n      const reason = `${event.account.address} is an invalid address`;\n\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle bitcoin specific address error\n\n\n    if (reason.includes('not a valid Bitcoin')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle ethereum specific address error\n\n\n    if (reason.includes('not a valid Ethereum')) {\n      if (this._onerror) {\n        this._onerror({\n          message: reason,\n          account: event.account.address\n        });\n\n        return;\n      } else {\n        throw new Error(reason);\n      }\n    } // handle config error\n\n\n    if (event && event.config) {\n      const configuration = this._configurations.get(event.config.scope);\n\n      if (configuration && configuration.subscription) {\n        configuration.subscription.error({\n          message: reason\n        });\n      }\n\n      return;\n    } // throw error that comes back from the server without formatting the message\n\n\n    if (this._onerror) {\n      this._onerror({\n        message: reason\n      });\n\n      return;\n    } else {\n      throw new Error(reason);\n    }\n  }\n\n  if (event && event.config) {\n    const casedScope = this._system === 'ethereum' ? event.config.scope.toLowerCase() : event.config.scope;\n\n    const configuration = this._configurations.get(casedScope);\n\n    if (configuration && configuration.subscription) {\n      configuration.subscription.next();\n    }\n  }\n\n  if (event && event.transaction) {\n    const {\n      transaction,\n      eventCode,\n      contractCall,\n      timeStamp,\n      blockchain: {\n        system,\n        network\n      }\n    } = event; // flatten in to one object\n\n    const newState = this._system === 'ethereum' ? { ...transaction,\n      serverVersion,\n      eventCode,\n      timeStamp,\n      dispatchTimestamp,\n      system,\n      network,\n      contractCall\n    } : { ...transaction,\n      serverVersion,\n      eventCode,\n      timeStamp,\n      dispatchTimestamp,\n      system,\n      network\n    }; // ignore server echo and unsubscribe messages\n\n    if (serverEcho(eventCode) || transaction.status === 'unsubscribed') {\n      return;\n    } // replace originalHash to match webhook API\n\n\n    if (newState.originalHash) {\n      newState.replaceHash = newState.hash;\n      newState.hash = newState.originalHash;\n      delete newState.originalHash;\n    } // replace status to match webhook API\n\n\n    if (eventCode === 'txSpeedUp' && newState.status !== 'speedup') {\n      newState.status = 'speedup';\n    } // replace status to match webhook API\n\n\n    if (eventCode === 'txCancel' && newState.status !== 'cancel') {\n      newState.status = 'cancel';\n    } // handle change of hash in speedup and cancel events\n\n\n    if (eventCode === 'txSpeedUp' || eventCode === 'txCancel') {\n      this._watchedTransactions = this._watchedTransactions.map(tx => {\n        if (tx.hash === newState.replaceHash) {\n          // reassign hash parameter in transaction queue to new hash or txid\n          tx.hash = transaction.hash || transaction.txid;\n        }\n\n        return tx;\n      });\n    }\n\n    const watchedAddress = transaction.watchedAddress && this._system === 'ethereum' ? transaction.watchedAddress.toLowerCase() : transaction.watchedAddress;\n\n    if (watchedAddress) {\n      const accountObj = this._watchedAccounts.find(ac => ac.address === watchedAddress);\n\n      const accountEmitterResult = accountObj ? last(accountObj.emitters.map(emitter => emitter.emit(newState))) : false;\n\n      const configuration = this._configurations.get(watchedAddress);\n\n      const emitterResult = configuration && configuration.emitter ? configuration.emitter.emit(newState) || accountEmitterResult : accountEmitterResult;\n\n      this._transactionHandlers.forEach(handler => handler({\n        transaction: newState,\n        emitterResult\n      }));\n    } else {\n      const transactionObj = this._watchedTransactions.find(tx => tx.hash === newState.hash || newState.txid);\n\n      const emitterResult = transactionObj && transactionObj.emitter.emit(newState);\n\n      this._transactionHandlers.forEach(handler => handler({\n        transaction: newState,\n        emitterResult\n      })); // replace the emitter hash to the replace hash on replacement txs\n\n\n      if (newState.status === 'speedup' || newState.status === 'cancel') {\n        this._watchedTransactions = this._watchedTransactions.map(tx => {\n          if (tx.hash === newState.hash || newState.txid) {\n            return { ...tx,\n              hash: newState.replaceHash\n            };\n          }\n\n          return tx;\n        });\n      }\n    }\n  }\n}\n\nfunction createEventLog(msg) {\n  return JSON.stringify({\n    timeStamp: new Date().toISOString(),\n    dappId: this._dappId,\n    version,\n    appName: this._appName,\n    appVersion: this._appVersion,\n    blockchain: {\n      system: this._system,\n      network: networkName(this._system, this._networkId) || 'local'\n    },\n    ...msg\n  }, msg.categoryCode === 'configs' ? jsonPreserveUndefined : undefined);\n}\n\nfunction waitForConnectionOpen() {\n  return new Promise(resolve => {\n    const interval = setInterval(() => {\n      if (this._connected) {\n        setTimeout(resolve, 100);\n        clearInterval(interval);\n      }\n    });\n  });\n}\n\nfunction validateType(options) {\n  const {\n    name,\n    value,\n    type,\n    optional,\n    customValidation\n  } = options;\n\n  if (!optional && typeof value === 'undefined') {\n    throw new Error(`\"${name}\" is required`);\n  }\n\n  if (typeof value !== 'undefined' && (type === 'array' ? Array.isArray(type) : typeof value !== type)) {\n    throw new Error(`\"${name}\" must be of type: ${type}, received type: ${typeof value} from value: ${value}`);\n  }\n\n  if (typeof value !== 'undefined' && customValidation && !customValidation(value)) {\n    throw new Error(`\"${value}\" is not a valid \"${name}\"`);\n  }\n}\n\nfunction validateOptions(options) {\n  validateType({\n    name: 'sdk options',\n    value: options,\n    type: 'object'\n  });\n  const {\n    dappId,\n    system,\n    name,\n    appVersion,\n    networkId,\n    transactionHandlers,\n    apiUrl,\n    ws,\n    onopen,\n    ondown,\n    onreopen,\n    onerror,\n    onclose,\n    ...otherParams\n  } = options;\n  invalidParams(otherParams, ['dappId', 'system', 'name', 'appVersion', 'networkId', 'transactionHandlers', 'apiUrl', 'ws', 'onopen', 'ondown', 'onreopen', 'onerror', 'onclose'], 'Initialization Options');\n  validateType({\n    name: 'dappId',\n    value: dappId,\n    type: 'string'\n  });\n  validateType({\n    name: 'system',\n    value: system,\n    type: 'string',\n    optional: true,\n    customValidation: validSystem\n  });\n  validateType({\n    name: 'name',\n    value: name,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'appVersion',\n    value: appVersion,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'networkId',\n    value: networkId,\n    type: 'number'\n  });\n  validateType({\n    name: 'transactionHandler',\n    value: transactionHandlers,\n    type: 'array',\n    optional: true\n  });\n\n  if (transactionHandlers) {\n    transactionHandlers.forEach(handler => validateType({\n      name: 'transactionHandler',\n      value: handler,\n      type: 'function'\n    }));\n  }\n\n  validateType({\n    name: 'apiUrl',\n    value: apiUrl,\n    type: 'string',\n    optional: true\n  });\n  validateType({\n    name: 'ws',\n    value: ws,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onopen',\n    value: onopen,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'ondown',\n    value: ondown,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onreopen',\n    value: onreopen,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onerror',\n    value: onerror,\n    type: 'function',\n    optional: true\n  });\n  validateType({\n    name: 'onclose',\n    value: onclose,\n    type: 'function',\n    optional: true\n  });\n}\n\nfunction validSystem(system) {\n  return !!networks[system];\n}\n\nfunction invalidParams(params, validParams, functionName) {\n  const invalid = Object.keys(params);\n\n  if (invalid.length > 0) {\n    throw new Error(`${invalid[0]} is not a valid parameter for ${functionName}, must be one of the following valid parameters: ${validParams.join(', ')}`);\n  }\n}\n\nconst DEFAULT_APP_NAME = 'unknown';\nconst DEFAULT_APP_VERSION = 'unknown';\nconst DEFAULT_SYSTEM = 'ethereum';\n\nclass Blocknative {\n  constructor(options) {\n    validateOptions(options);\n    const {\n      dappId,\n      system = DEFAULT_SYSTEM,\n      name = DEFAULT_APP_NAME,\n      appVersion = DEFAULT_APP_VERSION,\n      networkId,\n      transactionHandlers = [],\n      apiUrl,\n      ws,\n      onopen,\n      ondown,\n      onreopen,\n      onerror,\n      onclose\n    } = options; // override default timeout to allow for slow connections\n\n    const timeout = {\n      connectTimeout: 10000\n    };\n    const socket = new SturdyWebSocket(apiUrl || 'wss://api.blocknative.com/v0', ws ? {\n      wsConstructor: ws,\n      ...timeout\n    } : { ...timeout\n    });\n    socket.onopen = onOpen.bind(this, onopen);\n    socket.ondown = onDown.bind(this, ondown);\n    socket.onreopen = onReopen.bind(this, onreopen);\n    socket.onmessage = handleMessage.bind(this);\n\n    socket.onerror = error => onerror && onerror({\n      message: 'There was a WebSocket error',\n      error\n    });\n\n    socket.onclose = () => {\n      this._pingTimeout && clearInterval(this._pingTimeout);\n      onclose && onclose();\n    };\n\n    const storageKey = CryptoEs.SHA1(`${dappId} - ${name}`).toString();\n    const storedConnectionId = isLocalStorageAvailable() && window.localStorage.getItem(storageKey);\n    this._storageKey = storageKey;\n    this._connectionId = storedConnectionId || undefined;\n    this._dappId = dappId;\n    this._system = system;\n    this._networkId = networkId;\n    this._appName = name;\n    this._appVersion = appVersion;\n    this._transactionHandlers = transactionHandlers;\n    this._socket = socket;\n    this._connected = false;\n    this._sendMessage = sendMessage.bind(this);\n    this._watchedTransactions = [];\n    this._watchedAccounts = [];\n    this._configurations = new Map();\n    this._pingTimeout = undefined;\n    this._destroyed = false;\n    this._onerror = onerror;\n    this._queuedMessages = [];\n    this._limitRules = DEFAULT_RATE_LIMIT_RULES;\n    this._waitToRetry = null;\n    this._processingQueue = false;\n    this._processQueue = processQueue.bind(this);\n\n    if (this._socket.ws.on) {\n      this._heartbeat = () => {\n        this._pingTimeout && clearTimeout(this._pingTimeout);\n        this._pingTimeout = setTimeout(() => {\n          // terminate connection if we haven't heard the server ping after server timeout plus conservative latency delay\n          // Sturdy Websocket will handle the new connection logic\n          this._socket.ws.terminate();\n        }, 30000 + 1000);\n      };\n\n      this._socket.ws.on('ping', () => {\n        this._heartbeat && this._heartbeat();\n      });\n    } // public API\n\n\n    this.transaction = transaction.bind(this);\n    this.account = account.bind(this);\n    this.event = event.bind(this);\n    this.unsubscribe = unsubscribe.bind(this);\n    this.configuration = configuration.bind(this);\n\n    this.destroy = () => {\n      this._socket.close();\n\n      this._destroyed = true; // call onclose manually here as SturdyWebSocket doesn't currently work as expected\n      // https://github.com/dphilipson/sturdy-websocket/issues/5\n\n      this._socket.onclose();\n    };\n  }\n\n}\n\nfunction onOpen(handler) {\n  this._connected = true;\n  const msg = {\n    categoryCode: 'initialize',\n    eventCode: 'checkDappId',\n    connectionId: this._connectionId\n  }; // send this message directly rather than put in queue\n\n  this._socket.send(createEventLog.bind(this)(msg));\n\n  this._heartbeat && this._heartbeat();\n  handler && handler();\n}\n\nfunction onDown(handler, closeEvent) {\n  this._connected = false;\n\n  if (handler) {\n    handler(closeEvent);\n  }\n\n  this._pingTimeout && clearTimeout(this._pingTimeout);\n}\n\nasync function onReopen(handler) {\n  this._connected = true;\n  const msg = {\n    categoryCode: 'initialize',\n    eventCode: 'checkDappId',\n    connectionId: this._connectionId\n  };\n\n  this._socket.send(createEventLog.bind(this)(msg)); // re-register all configurations on re-connection\n\n\n  const configurations = Array.from(this._configurations.values()); // register global config first and wait for it to complete\n\n  const globalConfiguration = this._configurations.get('global');\n\n  if (globalConfiguration) {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const {\n        emitter,\n        subscription,\n        ...config\n      } = globalConfiguration;\n      await this.configuration(config);\n    } catch (error) {\n      console.warn('Error re-sending global configuration upon reconnection:', error);\n    }\n  }\n\n  const addressConfigurations = configurations.filter(({\n    scope\n  }) => scope !== 'global');\n  addressConfigurations.forEach(enhancedConfig => {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const {\n      emitter,\n      subscription,\n      ...config\n    } = enhancedConfig;\n\n    this._sendMessage({\n      categoryCode: 'configs',\n      eventCode: 'put',\n      config\n    });\n  }); // re-register all accounts to be watched by server upon\n  // re-connection as they don't get transferred over automatically\n  // to the new connection like tx hashes do\n\n  this._watchedAccounts.forEach(account => {\n    this._sendMessage({\n      eventCode: 'accountAddress',\n      categoryCode: 'watch',\n      account: {\n        address: account.address\n      }\n    });\n  });\n\n  if (handler) {\n    handler();\n  }\n\n  if (this._socket.ws && this._socket.ws.on) {\n    // need to re-register ping event since new connection\n    this._socket.ws.on('ping', () => {\n      this._heartbeat && this._heartbeat();\n    });\n\n    this._heartbeat();\n  }\n}\n\nexport default Blocknative;\n"]},"metadata":{},"sourceType":"module"}